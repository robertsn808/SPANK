<!-- Enhanced Dashboard Widgets for SPANKKS Construction -->
<div class="enhanced-widgets-section">
    <!-- Quick Actions Panel -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="quick-actions-panel">
                <h5 class="mb-3"><i class="fas fa-bolt"></i> Quick Actions</h5>
                <div class="row">
                    <div class="col-md-3 col-sm-6 mb-3">
                        <button class="btn btn-spankks w-100 quick-action-btn" onclick="showNewQuoteModal()">
                            <i class="fas fa-file-invoice-dollar"></i>
                            <span>New Quote</span>
                        </button>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <button class="btn btn-outline-spankks w-100 quick-action-btn" onclick="showScheduleModal()">
                            <i class="fas fa-calendar-plus"></i>
                            <span>Schedule Job</span>
                        </button>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <button class="btn btn-outline-spankks w-100 quick-action-btn" onclick="showClientModal()">
                            <i class="fas fa-user-plus"></i>
                            <span>Add Client</span>
                        </button>
                    </div>
                    <div class="col-md-3 col-sm-6 mb-3">
                        <button class="btn btn-outline-spankks w-100 quick-action-btn" onclick="generateReport()">
                            <i class="fas fa-chart-bar"></i>
                            <span>Generate Report</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Metrics Grid -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="metric-card revenue-card">
                <div class="metric-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="metric-content">
                    <h3 id="weeklyRevenue">$0</h3>
                    <p>This Week</p>
                    <div class="metric-trend">
                        <span class="trend-indicator positive" id="revenueTrend">+12%</span>
                        <small>vs last week</small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="metric-card jobs-card">
                <div class="metric-icon">
                    <i class="fas fa-hammer"></i>
                </div>
                <div class="metric-content">
                    <h3 id="activeJobs">0</h3>
                    <p>Active Jobs</p>
                    <div class="metric-trend">
                        <span class="trend-indicator neutral" id="jobsTrend">3 scheduled</span>
                        <small>this week</small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="metric-card quotes-card">
                <div class="metric-icon">
                    <i class="fas fa-file-invoice"></i>
                </div>
                <div class="metric-content">
                    <h3 id="pendingQuotes">0</h3>
                    <p>Pending Quotes</p>
                    <div class="metric-trend">
                        <span class="trend-indicator positive" id="quotesTrend">85% conversion</span>
                        <small>last 30 days</small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="metric-card efficiency-card">
                <div class="metric-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="metric-content">
                    <h3 id="efficiency">0%</h3>
                    <p>Efficiency</p>
                    <div class="metric-trend">
                        <span class="trend-indicator positive" id="efficiencyTrend">On track</span>
                        <small>capacity utilization</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Priority Alerts Panel -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="priority-alerts-panel">
                <h5 class="mb-3"><i class="fas fa-exclamation-triangle"></i> Priority Alerts</h5>
                <div id="priorityAlerts" class="alerts-container">
                    <!-- Alerts will be loaded dynamically -->
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity Timeline -->
    <div class="row">
        <div class="col-lg-8">
            <div class="activity-timeline-panel">
                <h5 class="mb-3"><i class="fas fa-history"></i> Recent Activity</h5>
                <div id="activityTimeline" class="timeline-container">
                    <!-- Timeline items will be loaded dynamically -->
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="staff-status-panel">
                <h5 class="mb-3"><i class="fas fa-users"></i> Staff Status</h5>
                <div id="staffStatus" class="staff-container">
                    <!-- Staff status will be loaded dynamically -->
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.enhanced-widgets-section {
    padding: 1rem 0;
}

.quick-actions-panel, .priority-alerts-panel, .activity-timeline-panel, .staff-status-panel {
    background: white;
    border-radius: 0.75rem;
    padding: 1.5rem;
    border: 1px solid #E5E7EB;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.metric-card {
    background: white;
    border-radius: 0.75rem;
    padding: 1.5rem;
    border: 1px solid #E5E7EB;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    position: relative;
    overflow: hidden;
}

.metric-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
}

.revenue-card::before { background: var(--success-green); }
.jobs-card::before { background: var(--primary-blue); }
.quotes-card::before { background: var(--accent-orange); }
.efficiency-card::before { background: var(--spankks-green); }

.metric-icon {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    opacity: 0.1;
}

.revenue-card .metric-icon { background: var(--success-green); color: white; }
.jobs-card .metric-icon { background: var(--primary-blue); color: white; }
.quotes-card .metric-icon { background: var(--accent-orange); color: white; }
.efficiency-card .metric-icon { background: var(--spankks-green); color: white; }

.metric-content h3 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
    color: var(--text-dark);
}

.metric-content p {
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.metric-trend {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.trend-indicator {
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.25rem 0.5rem;
    border-radius: 1rem;
}

.trend-indicator.positive {
    background: #D1FAE5;
    color: #065F46;
}

.trend-indicator.negative {
    background: #FEE2E2;
    color: #991B1B;
}

.trend-indicator.neutral {
    background: #F3F4F6;
    color: #374151;
}

.quick-action-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    padding: 1rem;
    border-radius: 0.5rem;
    transition: all 0.2s;
}

.quick-action-btn i {
    font-size: 1.5rem;
}

.quick-action-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.alerts-container {
    max-height: 200px;
    overflow-y: auto;
}

.timeline-container {
    max-height: 400px;
    overflow-y: auto;
}

.staff-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.staff-member {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background: #F9FAFB;
    border-radius: 0.5rem;
}

.staff-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--spankks-green);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
}

.staff-info h6 {
    margin: 0;
    font-size: 0.875rem;
    font-weight: 600;
}

.staff-status-badge {
    font-size: 0.75rem;
    padding: 0.125rem 0.5rem;
    border-radius: 1rem;
}

.status-available {
    background: #D1FAE5;
    color: #065F46;
}

.status-busy {
    background: #FEE2E2;
    color: #991B1B;
}

.status-break {
    background: #FEF3C7;
    color: #92400E;
}
</style>

<script>
function loadEnhancedMetrics() {
    // Load real-time metrics from API
    fetch('/api/dashboard/metrics')
        .then(response => response.json())
        .then(data => {
            document.getElementById('weeklyRevenue').textContent = `$${(data.weekly_revenue || 0).toLocaleString()}`;
            document.getElementById('activeJobs').textContent = data.active_jobs || 0;
            document.getElementById('pendingQuotes').textContent = data.pending_quotes || 0;
            document.getElementById('efficiency').textContent = `${data.efficiency || 0}%`;
            
            // Update trend indicators
            updateTrendIndicator('revenueTrend', data.revenue_trend);
            updateTrendIndicator('jobsTrend', data.jobs_trend);
            updateTrendIndicator('quotesTrend', data.quotes_trend);
            updateTrendIndicator('efficiencyTrend', data.efficiency_trend);
        })
        .catch(error => {
            console.error('Error loading metrics:', error);
        });
}

function updateTrendIndicator(elementId, trendData) {
    const element = document.getElementById(elementId);
    if (element && trendData) {
        element.textContent = trendData.text;
        element.className = `trend-indicator ${trendData.type}`;
    }
}

function loadPriorityAlerts() {
    fetch('/api/dashboard/alerts')
        .then(response => response.json())
        .then(alerts => {
            const container = document.getElementById('priorityAlerts');
            if (alerts.length === 0) {
                container.innerHTML = '<div class="alert alert-success mb-0"><i class="fas fa-check-circle me-2"></i>No priority alerts at this time</div>';
                return;
            }
            
            container.innerHTML = alerts.map(alert => `
                <div class="alert alert-${alert.type} mb-2">
                    <i class="fas fa-${alert.icon} me-2"></i>
                    <strong>${alert.title}:</strong> ${alert.message}
                    ${alert.action ? `<button class="btn btn-sm btn-outline-${alert.type} ms-2" onclick="${alert.action}">${alert.action_text}</button>` : ''}
                </div>
            `).join('');
        })
        .catch(error => {
            console.error('Error loading alerts:', error);
        });
}

function loadStaffStatus() {
    fetch('/api/dashboard/staff-status')
        .then(response => response.json())
        .then(staff => {
            const container = document.getElementById('staffStatus');
            container.innerHTML = staff.map(member => `
                <div class="staff-member">
                    <div class="staff-avatar">${member.initials}</div>
                    <div class="staff-info flex-grow-1">
                        <h6>${member.name}</h6>
                        <small class="text-muted">${member.role}</small>
                    </div>
                    <span class="staff-status-badge status-${member.status}">${member.status_text}</span>
                </div>
            `).join('');
        })
        .catch(error => {
            console.error('Error loading staff status:', error);
        });
}

// Initialize enhanced widgets
document.addEventListener('DOMContentLoaded', function() {
    loadEnhancedMetrics();
    loadPriorityAlerts();
    loadStaffStatus();
    
    // Refresh metrics every 5 minutes
    setInterval(loadEnhancedMetrics, 300000);
});
</script>