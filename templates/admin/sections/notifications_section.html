<style>
body {
    background-color: #f8f9fa !important;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}
.container-fluid {
    background-color: #f8f9fa;
    min-height: 100vh;
    padding: 20px;
}
</style>

<div class="container-fluid">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <a href="/admin-home" class="btn btn-outline-secondary me-3">
                        <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
                    </a>
                    <div>
                        <h2 class="mb-0"><i class="fas fa-bell me-2 text-primary"></i>Notifications</h2>
                        <p class="text-muted mb-0">Manage system notifications and alerts</p>
                    </div>
                </div>
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="markAllRead()">
                        <i class="fas fa-check me-1"></i>Mark All Read
                    </button>
                    <button class="btn btn-outline-success" onclick="refreshNotifications()">
                        <i class="fas fa-sync-alt me-1"></i>Refresh
                    </button>
                    <button class="btn btn-outline-danger" onclick="clearAll()">
                        <i class="fas fa-trash me-1"></i>Clear All
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Statistics -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="text-primary mb-2">
                        <i class="fas fa-envelope fa-2x"></i>
                    </div>
                    <h4 class="mb-1" id="totalNotifications">0</h4>
                    <p class="text-muted mb-0">Total Notifications</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="text-warning mb-2">
                        <i class="fas fa-exclamation-circle fa-2x"></i>
                    </div>
                    <h4 class="mb-1" id="unreadNotifications">0</h4>
                    <p class="text-muted mb-0">Unread</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="text-success mb-2">
                        <i class="fas fa-check-circle fa-2x"></i>
                    </div>
                    <h4 class="mb-1" id="readNotifications">0</h4>
                    <p class="text-muted mb-0">Read</p>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="text-info mb-2">
                        <i class="fas fa-clock fa-2x"></i>
                    </div>
                    <h4 class="mb-1" id="todayNotifications">0</h4>
                    <p class="text-muted mb-0">Today</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notifications List -->
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-0 py-3">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5 class="mb-0"><i class="fas fa-list me-2"></i>Recent Notifications</h5>
                </div>
                <div class="col-md-6">
                    <div class="d-flex justify-content-end">
                        <select class="form-select form-select-sm me-2" id="filterType" onchange="filterNotifications()">
                            <option value="">All Types</option>
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                            <option value="error">Error</option>
                            <option value="success">Success</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th style="width: 50px;">
                                <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                            </th>
                            <th>Type</th>
                            <th>Message</th>
                            <th>Time</th>
                            <th>Status</th>
                            <th style="width: 120px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="notificationsTableBody">
                        <!-- Notifications will be populated here -->
                        <tr>
                            <td colspan="6" class="text-center py-4">
                                <div class="text-muted">
                                    <i class="fas fa-bell-slash fa-2x mb-2"></i>
                                    <p class="mb-0">No notifications available</p>
                                    <small>Notifications will appear here when system events occur</small>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
// Notifications Management JavaScript
let notifications = [];

document.addEventListener('DOMContentLoaded', function() {
    console.log('Notifications: Page loaded');
    loadNotifications();
    
    // Auto-refresh every 30 seconds
    setInterval(loadNotifications, 30000);
});

function loadNotifications() {
    // For now, create sample notifications since the table might not exist
    notifications = [
        {
            id: 1,
            type: 'info',
            message: 'New quote request received from client',
            created_at: new Date().toISOString(),
            is_read: false
        },
        {
            id: 2,
            type: 'success',
            message: 'Invoice payment received successfully',
            created_at: new Date(Date.now() - 3600000).toISOString(),
            is_read: true
        },
        {
            id: 3,
            type: 'warning',
            message: 'Job completion pending review',
            created_at: new Date(Date.now() - 7200000).toISOString(),
            is_read: false
        }
    ];
    
    renderNotificationsTable();
    updateNotificationStats();
}

function renderNotificationsTable() {
    const tbody = document.getElementById('notificationsTableBody');
    
    if (notifications.length === 0) {
        tbody.innerHTML = `
            <tr>
                <td colspan="6" class="text-center py-4">
                    <div class="text-muted">
                        <i class="fas fa-bell-slash fa-2x mb-2"></i>
                        <p class="mb-0">No notifications available</p>
                        <small>Notifications will appear here when system events occur</small>
                    </div>
                </td>
            </tr>
        `;
        return;
    }
    
    tbody.innerHTML = '';
    
    notifications.forEach(notification => {
        const typeIcon = {
            'info': '<i class="fas fa-info-circle text-primary"></i>',
            'success': '<i class="fas fa-check-circle text-success"></i>',
            'warning': '<i class="fas fa-exclamation-triangle text-warning"></i>',
            'error': '<i class="fas fa-times-circle text-danger"></i>'
        }[notification.type] || '<i class="fas fa-bell text-secondary"></i>';
        
        const statusBadge = notification.is_read 
            ? '<span class="badge bg-success">Read</span>'
            : '<span class="badge bg-warning">Unread</span>';
        
        const time = new Date(notification.created_at).toLocaleString();
        
        const row = `
            <tr ${!notification.is_read ? 'class="table-warning"' : ''}>
                <td><input type="checkbox" value="${notification.id}"></td>
                <td>${typeIcon}</td>
                <td>
                    <strong>${notification.message}</strong>
                    ${!notification.is_read ? '<span class="badge bg-primary ms-2">New</span>' : ''}
                </td>
                <td><small class="text-muted">${time}</small></td>
                <td>${statusBadge}</td>
                <td>
                    <div class="btn-group btn-group-sm">
                        ${!notification.is_read ? `<button class="btn btn-outline-primary btn-sm" onclick="markAsRead(${notification.id})" title="Mark as read"><i class="fas fa-check"></i></button>` : ''}
                        <button class="btn btn-outline-danger btn-sm" onclick="deleteNotification(${notification.id})" title="Delete"><i class="fas fa-trash"></i></button>
                    </div>
                </td>
            </tr>
        `;
        
        tbody.insertAdjacentHTML('beforeend', row);
    });
}

function updateNotificationStats() {
    const total = notifications.length;
    const unread = notifications.filter(n => !n.is_read).length;
    const read = notifications.filter(n => n.is_read).length;
    const today = notifications.filter(n => {
        const notificationDate = new Date(n.created_at);
        const today = new Date();
        return notificationDate.toDateString() === today.toDateString();
    }).length;
    
    document.getElementById('totalNotifications').textContent = total;
    document.getElementById('unreadNotifications').textContent = unread;
    document.getElementById('readNotifications').textContent = read;
    document.getElementById('todayNotifications').textContent = today;
}

function markAsRead(id) {
    const notification = notifications.find(n => n.id === id);
    if (notification) {
        notification.is_read = true;
        renderNotificationsTable();
        updateNotificationStats();
    }
}

function markAllRead() {
    notifications.forEach(n => n.is_read = true);
    renderNotificationsTable();
    updateNotificationStats();
}

function deleteNotification(id) {
    if (confirm('Are you sure you want to delete this notification?')) {
        notifications = notifications.filter(n => n.id !== id);
        renderNotificationsTable();
        updateNotificationStats();
    }
}

function clearAll() {
    if (confirm('Are you sure you want to clear all notifications?')) {
        notifications = [];
        renderNotificationsTable();
        updateNotificationStats();
    }
}

function refreshNotifications() {
    console.log('Refreshing notifications...');
    loadNotifications();
}

function filterNotifications() {
    const filterType = document.getElementById('filterType').value;
    const rows = document.querySelectorAll('#notificationsTableBody tr');
    
    rows.forEach(row => {
        if (row.cells.length > 1) {
            const typeCell = row.cells[1];
            const hasType = !filterType || typeCell.textContent.toLowerCase().includes(filterType);
            row.style.display = hasType ? '' : 'none';
        }
    });
}

function toggleSelectAll() {
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('#notificationsTableBody input[type="checkbox"]');
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
    });
}
</script>