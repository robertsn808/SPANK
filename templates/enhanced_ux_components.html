<!-- Enhanced UX Components with Tooltips, Cancel Buttons, and Form Grouping -->
<style>
/* Tooltip System */
.tooltip-container {
    position: relative;
    display: inline-block;
}

.custom-tooltip {
    visibility: hidden;
    background-color: #333;
    color: white;
    text-align: center;
    border-radius: 6px;
    padding: 8px 12px;
    position: absolute;
    z-index: 9999;
    bottom: 125%;
    left: 50%;
    margin-left: -75px;
    width: 150px;
    font-size: 12px;
    opacity: 0;
    transition: opacity 0.3s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.custom-tooltip:after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #333 transparent transparent transparent;
}

.tooltip-container:hover .custom-tooltip {
    visibility: visible;
    opacity: 1;
}

/* Enhanced Button Tooltips */
.btn-with-tooltip {
    position: relative;
}

.btn-with-tooltip:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: #333;
    color: white;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 11px;
    white-space: nowrap;
    z-index: 9999;
    margin-bottom: 5px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

/* Form Section Grouping */
.form-section {
    background: white;
    border: 1px solid #e1e5e9;
    border-radius: 12px;
    margin-bottom: 20px;
    overflow: hidden;
    box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}

.form-section-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 15px 20px;
    border-bottom: 1px solid #e1e5e9;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

.form-section-header:hover {
    background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
}

.form-section-title {
    font-weight: 600;
    color: #495057;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.form-section-toggle {
    font-size: 18px;
    color: #6c757d;
    transition: transform 0.3s ease;
}

.form-section.collapsed .form-section-toggle {
    transform: rotate(-90deg);
}

.form-section-body {
    padding: 20px;
    transition: max-height 0.3s ease, padding 0.3s ease;
    overflow: hidden;
}

.form-section.collapsed .form-section-body {
    max-height: 0;
    padding: 0 20px;
}

/* Enhanced Form Controls */
.form-group-enhanced {
    margin-bottom: 20px;
}

.form-label-enhanced {
    display: block;
    font-weight: 500;
    color: #495057;
    margin-bottom: 8px;
    font-size: 14px;
}

.form-control-enhanced {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.2s ease;
    background-color: #fff;
}

.form-control-enhanced:focus {
    border-color: #007bff;
    outline: none;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,.15);
    background-color: #fafbfc;
}

.form-control-enhanced.is-invalid {
    border-color: #dc3545;
}

.form-control-enhanced.is-valid {
    border-color: #28a745;
}

/* Form Actions with Cancel Buttons */
.form-actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    align-items: center;
    padding: 20px;
    background: #f8f9fa;
    border-top: 1px solid #e1e5e9;
    margin: 20px -20px -20px;
}

.form-actions-left {
    margin-right: auto;
}

.btn-cancel {
    background: #6c757d;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    text-decoration: none;
}

.btn-cancel:hover {
    background: #5a6268;
    transform: translateY(-1px);
    color: white;
    text-decoration: none;
}

.btn-save {
    background: #007bff;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.btn-save:hover {
    background: #0056b3;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,123,255,0.3);
}

/* Collapsible Cards */
.collapsible-card {
    background: white;
    border: 1px solid #e1e5e9;
    border-radius: 12px;
    margin-bottom: 16px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    transition: box-shadow 0.2s ease;
}

.collapsible-card:hover {
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
}

.card-header-collapsible {
    padding: 16px 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid #e1e5e9;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color 0.2s ease;
}

.card-header-collapsible:hover {
    background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
}

.card-title-collapsible {
    font-weight: 600;
    color: #495057;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 12px;
}

.card-icon {
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #007bff;
    color: white;
    border-radius: 4px;
    font-size: 12px;
}

.card-collapse-indicator {
    font-size: 16px;
    color: #6c757d;
    transition: transform 0.3s ease;
}

.collapsible-card.collapsed .card-collapse-indicator {
    transform: rotate(-90deg);
}

.card-body-collapsible {
    padding: 20px;
    transition: max-height 0.3s ease, padding 0.3s ease;
    overflow: hidden;
}

.collapsible-card.collapsed .card-body-collapsible {
    max-height: 0;
    padding: 0 20px;
}

/* Tab System */
.tabs-container {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    margin-bottom: 20px;
}

.tabs-nav {
    display: flex;
    background: #f8f9fa;
    border-bottom: 1px solid #e1e5e9;
    overflow-x: auto;
}

.tab-item {
    padding: 16px 24px;
    background: none;
    border: none;
    color: #6c757d;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    border-bottom: 3px solid transparent;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 8px;
}

.tab-item:hover {
    background: #e9ecef;
    color: #495057;
}

.tab-item.active {
    background: white;
    color: #007bff;
    border-bottom-color: #007bff;
}

.tab-content {
    padding: 24px;
}

.tab-pane {
    display: none;
}

.tab-pane.active {
    display: block;
}

/* Enhanced Progress Indicators */
.progress-steps {
    display: flex;
    justify-content: space-between;
    margin-bottom: 30px;
    position: relative;
}

.progress-steps::before {
    content: '';
    position: absolute;
    top: 20px;
    left: 0;
    right: 0;
    height: 2px;
    background: #e1e5e9;
    z-index: 1;
}

.progress-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
    background: white;
    padding: 0 10px;
}

.progress-step-circle {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #e1e5e9;
    color: #6c757d;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    margin-bottom: 8px;
    transition: all 0.3s ease;
}

.progress-step.completed .progress-step-circle {
    background: #28a745;
    color: white;
}

.progress-step.active .progress-step-circle {
    background: #007bff;
    color: white;
    box-shadow: 0 0 0 4px rgba(0,123,255,0.25);
}

.progress-step-label {
    font-size: 12px;
    text-align: center;
    color: #6c757d;
    font-weight: 500;
}

.progress-step.completed .progress-step-label,
.progress-step.active .progress-step-label {
    color: #495057;
}

/* Mobile Optimizations */
@media (max-width: 768px) {
    .form-section-body {
        padding: 15px;
    }
    
    .form-actions {
        flex-direction: column-reverse;
        gap: 8px;
        padding: 15px;
    }
    
    .form-actions .btn-cancel,
    .form-actions .btn-save {
        width: 100%;
        justify-content: center;
    }
    
    .tabs-nav {
        flex-wrap: nowrap;
        overflow-x: auto;
    }
    
    .tab-item {
        padding: 12px 16px;
        font-size: 14px;
    }
    
    .tab-content {
        padding: 16px;
    }
    
    .progress-steps {
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
    }
    
    .progress-steps::before {
        display: none;
    }
    
    .collapsible-card {
        margin-bottom: 12px;
    }
    
    .card-header-collapsible {
        padding: 12px 16px;
    }
    
    .card-body-collapsible {
        padding: 16px;
    }
}

@media (max-width: 480px) {
    .form-section-header {
        padding: 12px 15px;
    }
    
    .form-section-body {
        padding: 12px 15px;
    }
    
    .custom-tooltip {
        width: 120px;
        margin-left: -60px;
        font-size: 11px;
    }
}
</style>

<!-- Enhanced Quote/Invoice Form with Sections - Removed from global include -->
<!-- This form should only be included on specific quote/invoice pages -->
<!--
<div class="container-fluid">
    <!-- Progress Steps -->
    <div class="progress-steps">
        <div class="progress-step completed">
            <div class="progress-step-circle">
                <i class="fas fa-user"></i>
            </div>
            <div class="progress-step-label">Client Info</div>
        </div>
        <div class="progress-step active">
            <div class="progress-step-circle">
                <i class="fas fa-list"></i>
            </div>
            <div class="progress-step-label">Services</div>
        </div>
        <div class="progress-step">
            <div class="progress-step-circle">
                <i class="fas fa-calculator"></i>
            </div>
            <div class="progress-step-label">Pricing</div>
        </div>
        <div class="progress-step">
            <div class="progress-step-circle">
                <i class="fas fa-check"></i>
            </div>
            <div class="progress-step-label">Review</div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tabs-container">
        <div class="tabs-nav">
            <button class="tab-item active" onclick="switchTab('client-info')">
                <i class="fas fa-user"></i>
                Client Information
            </button>
            <button class="tab-item" onclick="switchTab('services')">
                <i class="fas fa-tools"></i>
                Services & Items
            </button>
            <button class="tab-item" onclick="switchTab('pricing')">
                <i class="fas fa-dollar-sign"></i>
                Pricing & Tax
            </button>
            <button class="tab-item" onclick="switchTab('notes')">
                <i class="fas fa-sticky-note"></i>
                Notes & Terms
            </button>
        </div>
        
        <!-- Client Information Tab -->
        <div class="tab-content">
            <div class="tab-pane active" id="client-info">
                <div class="form-section">
                    <div class="form-section-header" onclick="toggleSection(this)">
                        <h5 class="form-section-title">
                            <i class="fas fa-user-circle"></i>
                            Client Details
                        </h5>
                        <i class="fas fa-chevron-down form-section-toggle"></i>
                    </div>
                    <div class="form-section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-enhanced">
                                    <label class="form-label-enhanced">Client Name *</label>
                                    <input type="text" class="form-control-enhanced" placeholder="Full name" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group-enhanced">
                                    <label class="form-label-enhanced">Phone Number *</label>
                                    <input type="tel" class="form-control-enhanced" placeholder="(808) 555-0123" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-enhanced">
                                    <label class="form-label-enhanced">Email Address</label>
                                    <input type="email" class="form-control-enhanced" placeholder="client@example.com">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group-enhanced">
                                    <label class="form-label-enhanced">Preferred Contact Method</label>
                                    <select class="form-control-enhanced">
                                        <option value="phone">Phone Call</option>
                                        <option value="text">Text Message</option>
                                        <option value="email">Email</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-header" onclick="toggleSection(this)">
                        <h5 class="form-section-title">
                            <i class="fas fa-map-marker-alt"></i>
                            Job Location
                        </h5>
                        <i class="fas fa-chevron-down form-section-toggle"></i>
                    </div>
                    <div class="form-section-body">
                        <div class="form-group-enhanced">
                            <label class="form-label-enhanced">Street Address *</label>
                            <input type="text" class="form-control-enhanced" placeholder="123 Main Street" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-enhanced">
                                    <label class="form-label-enhanced">City *</label>
                                    <input type="text" class="form-control-enhanced" placeholder="Honolulu" required>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group-enhanced">
                                    <label class="form-label-enhanced">State</label>
                                    <input type="text" class="form-control-enhanced" value="Hawaii" readonly>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group-enhanced">
                                    <label class="form-label-enhanced">ZIP Code</label>
                                    <input type="text" class="form-control-enhanced" placeholder="96801">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Services Tab -->
            <div class="tab-pane" id="services">
                <div class="form-section">
                    <div class="form-section-header">
                        <h5 class="form-section-title">
                            <i class="fas fa-tools"></i>
                            Service Details
                        </h5>
                        <button class="btn btn-sm btn-outline-primary btn-with-tooltip" 
                                data-tooltip="Add another service line"
                                onclick="addServiceLine()">
                            <i class="fas fa-plus"></i>
                            Add Service
                        </button>
                    </div>
                    <div class="form-section-body">
                        <div class="service-line" id="service-1">
                            <div class="row align-items-end">
                                <div class="col-md-5">
                                    <div class="form-group-enhanced">
                                        <label class="form-label-enhanced">Service Description *</label>
                                        <input type="text" class="form-control-enhanced" 
                                               placeholder="e.g., Drywall repair and paint touch-up" required>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group-enhanced">
                                        <label class="form-label-enhanced">Quantity</label>
                                        <input type="number" class="form-control-enhanced" value="1" min="1">
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group-enhanced">
                                        <label class="form-label-enhanced">Rate</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" class="form-control-enhanced" step="0.01" placeholder="0.00">
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group-enhanced">
                                        <label class="form-label-enhanced">Total</label>
                                        <div class="input-group">
                                            <span class="input-group-text">$</span>
                                            <input type="number" class="form-control-enhanced" step="0.01" readonly>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-1">
                                    <button class="btn btn-outline-danger btn-with-tooltip" 
                                            data-tooltip="Remove this service line"
                                            onclick="removeServiceLine('service-1')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pricing Tab -->
            <div class="tab-pane" id="pricing">
                <div class="form-section">
                    <div class="form-section-header">
                        <h5 class="form-section-title">
                            <i class="fas fa-calculator"></i>
                            Pricing Summary
                        </h5>
                    </div>
                    <div class="form-section-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-enhanced">
                                    <label class="form-label-enhanced">Subtotal</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control-enhanced" step="0.01" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group-enhanced">
                                    <label class="form-label-enhanced">Discount %</label>
                                    <input type="number" class="form-control-enhanced" min="0" max="100" step="0.01" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group-enhanced">
                                    <label class="form-label-enhanced">Hawaii GET Tax (4.712%)</label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control-enhanced" step="0.01" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group-enhanced">
                                    <label class="form-label-enhanced"><strong>Total Amount</strong></label>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" class="form-control-enhanced" step="0.01" readonly 
                                               style="font-weight: bold; font-size: 18px;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notes Tab -->
            <div class="tab-pane" id="notes">
                <div class="form-section">
                    <div class="form-section-header">
                        <h5 class="form-section-title">
                            <i class="fas fa-sticky-note"></i>
                            Additional Information
                        </h5>
                    </div>
                    <div class="form-section-body">
                        <div class="form-group-enhanced">
                            <label class="form-label-enhanced">Special Instructions</label>
                            <textarea class="form-control-enhanced" rows="4" 
                                      placeholder="Any special requirements, access instructions, or notes..."></textarea>
                        </div>
                        <div class="form-group-enhanced">
                            <label class="form-label-enhanced">Terms & Conditions</label>
                            <textarea class="form-control-enhanced" rows="3" 
                                      placeholder="Payment terms, warranty information, etc..."></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Form Actions with Cancel Button -->
    <div class="form-actions">
        <div class="form-actions-left">
            <button class="btn-cancel btn-with-tooltip" 
                    data-tooltip="Discard changes and return"
                    onclick="window.history.back()">
                <i class="fas fa-arrow-left"></i>
                Cancel & Go Back
            </button>
        </div>
        <button class="btn btn-outline-secondary btn-with-tooltip" 
                data-tooltip="Save as draft for later"
                onclick="saveDraft()">
            <i class="fas fa-save"></i>
            Save Draft
        </button>
        <button class="btn-save btn-with-tooltip" 
                data-tooltip="Generate final quote/invoice"
                onclick="generateDocument()">
            <i class="fas fa-file-pdf"></i>
            Generate Quote
        </button>
    </div>
</div>

<script>
// Enhanced UX JavaScript Functions
function toggleSection(header) {
    const section = header.parentElement;
    section.classList.toggle('collapsed');
}

function switchTab(tabId) {
    // Hide all tab panes
    document.querySelectorAll('.tab-pane').forEach(pane => {
        pane.classList.remove('active');
    });
    
    // Remove active from all tab items
    document.querySelectorAll('.tab-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Show selected tab
    document.getElementById(tabId).classList.add('active');
    event.target.closest('.tab-item').classList.add('active');
}

function addServiceLine() {
    const serviceCount = document.querySelectorAll('.service-line').length + 1;
    const serviceContainer = document.querySelector('.form-section-body');
    
    const newServiceLine = document.createElement('div');
    newServiceLine.className = 'service-line';
    newServiceLine.id = `service-${serviceCount}`;
    newServiceLine.innerHTML = `
        <div class="row align-items-end">
            <div class="col-md-5">
                <div class="form-group-enhanced">
                    <label class="form-label-enhanced">Service Description *</label>
                    <input type="text" class="form-control-enhanced" 
                           placeholder="e.g., Additional service description" required>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group-enhanced">
                    <label class="form-label-enhanced">Quantity</label>
                    <input type="number" class="form-control-enhanced" value="1" min="1">
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group-enhanced">
                    <label class="form-label-enhanced">Rate</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input type="number" class="form-control-enhanced" step="0.01" placeholder="0.00">
                    </div>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group-enhanced">
                    <label class="form-label-enhanced">Total</label>
                    <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input type="number" class="form-control-enhanced" step="0.01" readonly>
                    </div>
                </div>
            </div>
            <div class="col-md-1">
                <button class="btn btn-outline-danger btn-with-tooltip" 
                        data-tooltip="Remove this service line"
                        onclick="removeServiceLine('service-${serviceCount}')">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    `;
    
    serviceContainer.appendChild(newServiceLine);
    showToast('Service line added', 'success');
}

function removeServiceLine(serviceId) {
    if (document.querySelectorAll('.service-line').length <= 1) {
        showToast('At least one service line is required', 'warning');
        return;
    }
    
    if (confirm('Remove this service line?')) {
        document.getElementById(serviceId).remove();
        showToast('Service line removed', 'info');
    }
}

function saveDraft() {
    showToast('Draft saved successfully', 'success');
}

function generateDocument() {
    if (confirm('Generate final quote with current information?')) {
        showToast('Generating quote PDF...', 'info');
        // Simulate generation process
        setTimeout(() => {
            showToast('Quote generated successfully!', 'success');
        }, 2000);
    }
}
-->

<script>
function showToast(message, type) {
    const toast = document.createElement('div');
    toast.className = `alert alert-${type === 'warning' ? 'warning' : type === 'info' ? 'info' : type === 'success' ? 'success' : 'primary'} position-fixed`;
    toast.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    toast.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="fas fa-${type === 'warning' ? 'exclamation-triangle' : type === 'info' ? 'info-circle' : type === 'success' ? 'check-circle' : 'bell'} me-2"></i>
            <span>${message}</span>
            <button type="button" class="btn-close ms-auto" onclick="this.closest('.alert').remove()"></button>
        </div>
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        if (toast.parentElement) {
            toast.remove();
        }
    }, 4000);
}

// Initialize collapsible cards
document.addEventListener('DOMContentLoaded', function() {
    // Add click handlers to collapsible card headers
    document.querySelectorAll('.card-header-collapsible').forEach(header => {
        header.addEventListener('click', function() {
            const card = this.parentElement;
            card.classList.toggle('collapsed');
        });
    });
    
    // Initialize tooltips for mobile
    if (window.innerWidth <= 768) {
        document.querySelectorAll('.btn-with-tooltip').forEach(btn => {
            btn.addEventListener('click', function(e) {
                // Show tooltip briefly on mobile tap
                const tooltip = this.getAttribute('data-tooltip');
                if (tooltip) {
                    showToast(tooltip, 'info');
                }
            });
        });
    }
});
</script>