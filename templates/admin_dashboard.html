{% extends "admin_base.html" %}

{% block title %}Admin Dashboard - SPANKKS Construction{% endblock %}

{% block content %}
<style>
.calendar-day-card {
    border: 1px solid #dee2e6;
    border-radius: 8px;
    background: white;
    transition: all 0.2s ease;
    height: 100%;
}
.calendar-day-card:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.day-header {
    border-radius: 8px 8px 0 0;
    border-bottom: 1px solid #dee2e6;
}
.appointment-block {
    font-size: 0.75rem;
    line-height: 1.2;
}

/* Side Menu Styles */
.side-menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1040;
    display: none;
}

.side-menu {
    position: fixed;
    top: 0;
    right: -350px;
    width: 350px;
    height: 100%;
    background: white;
    box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
    z-index: 1050;
    transition: right 0.3s ease;
    overflow-y: auto;
}

.side-menu.active {
    right: 0;
}

.side-menu-header {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    padding: 1rem;
    position: sticky;
    top: 0;
    z-index: 10;
}

.side-menu-close {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    float: right;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.side-menu-content {
    padding: 1rem;
}

.menu-section {
    margin-bottom: 1.5rem;
}

.menu-section-title {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #6c757d;
    margin-bottom: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #dee2e6;
}

.menu-item {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    color: #495057;
    text-decoration: none;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    transition: all 0.2s ease;
}

.menu-item:hover {
    background: #f8f9fa;
    color: #28a745;
    text-decoration: none;
    transform: translateX(5px);
}

.menu-item i {
    width: 20px;
    margin-right: 0.75rem;
    font-size: 1rem;
}

.menu-item-text {
    font-weight: 500;
}

.menu-item-desc {
    font-size: 0.75rem;
    color: #6c757d;
    margin-top: 0.25rem;
}

.quick-actions-toggle {
    position: fixed;
    top: 50%;
    right: 20px;
    transform: translateY(-50%);
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 1.5rem;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 1030;
}

.quick-actions-toggle:hover {
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
}

.quick-actions-toggle.active {
    background: linear-gradient(135deg, #dc3545, #e74c3c);
}

@media (max-width: 768px) {
    .side-menu {
        width: 100%;
        right: -100%;
    }
    
    .calendar-day-card {
        margin-bottom: 0.5rem;
    }
    
    .quick-actions-toggle {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
        right: 15px;
    }
}
</style>
<div class="container-fluid py-3">
    <!-- Stats Cards Row -->
    <div class="row g-3 mb-4">
        <div class="col-6 col-md-3">
            <div class="card text-center border-0 shadow-sm">
                <div class="card-body py-3">
                    <i class="fas fa-clipboard-list fa-2x text-primary mb-2"></i>
                    <h3 class="card-title h4 mb-1">{{ bookings|length if bookings else 0 }}</h3>
                    <p class="card-text text-muted small">Total Requests</p>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card text-center border-0 shadow-sm">
                <div class="card-body py-3">
                    <i class="fas fa-coins fa-2x text-warning mb-2"></i>
                    <h3 class="card-title h4 mb-1">{{ pending_requests|length if pending_requests else 0 }}</h3>
                    <p class="card-text text-muted small">Pending</p>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card text-center border-0 shadow-sm">
                <div class="card-body py-3">
                    <i class="fas fa-envelope fa-2x text-info mb-2"></i>
                    <h3 class="card-title h4 mb-1">{{ contact_messages|length if contact_messages else 0 }}</h3>
                    <p class="card-text text-muted small">Messages</p>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card text-center border-0 shadow-sm">
                <div class="card-body py-3">
                    <i class="fas fa-calendar-week fa-2x text-success mb-2"></i>
                    <h3 class="card-title h4 mb-1">{{ week_appointments|length if week_appointments else 0 }}</h3>
                    <p class="card-text text-muted small">This Week</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Toggle Button -->
    <button class="quick-actions-toggle" id="quickActionsToggle" onclick="toggleSideMenu()">
        <i class="fas fa-bolt"></i>
    </button>

    <!-- Side Menu Overlay -->
    <div class="side-menu-overlay" id="sideMenuOverlay" onclick="closeSideMenu()"></div>

    <!-- Side Menu -->
    <div class="side-menu" id="sideMenu">
        <div class="side-menu-header">
            <h5 class="mb-0">
                <i class="fas fa-bolt me-2"></i>
                Quick Actions
            </h5>
            <button class="side-menu-close" onclick="closeSideMenu()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="side-menu-content">
            <!-- Core Business Section -->
            <div class="menu-section">
                <div class="menu-section-title">Core Business</div>
                
                <a href="{{ url_for('crm_dashboard') }}" class="menu-item">
                    <i class="fas fa-users text-primary"></i>
                    <div>
                        <div class="menu-item-text">CRM Dashboard</div>
                        <div class="menu-item-desc">Manage customer relationships</div>
                    </div>
                </a>
                
                <a href="{{ url_for('quote_invoice_form') }}" class="menu-item">
                    <i class="fas fa-file-invoice-dollar text-success"></i>
                    <div>
                        <div class="menu-item-text">Quote & Invoice</div>
                        <div class="menu-item-desc">Generate quotes and invoices</div>
                    </div>
                </a>
                
                <a href="{{ url_for('job_schedule') }}" class="menu-item">
                    <i class="fas fa-calendar text-info"></i>
                    <div>
                        <div class="menu-item-text">Job Schedule</div>
                        <div class="menu-item-desc">View and manage appointments</div>
                    </div>
                </a>
                
                <a href="{{ url_for('contact_list') }}" class="menu-item">
                    <i class="fas fa-address-book text-secondary"></i>
                    <div>
                        <div class="menu-item-text">Contact Database</div>
                        <div class="menu-item-desc">Manage customer contacts</div>
                    </div>
                </a>
            </div>

            <!-- Operations Section -->
            <div class="menu-section">
                <div class="menu-section-title">Operations</div>
                
                <a href="{{ url_for('staff_management') }}" class="menu-item">
                    <i class="fas fa-hard-hat text-warning"></i>
                    <div>
                        <div class="menu-item-text">Staff Management</div>
                        <div class="menu-item-desc">Manage crew and assignments</div>
                    </div>
                </a>
                
                <a href="{{ url_for('inventory_dashboard') }}" class="menu-item">
                    <i class="fas fa-boxes text-info"></i>
                    <div>
                        <div class="menu-item-text">Inventory</div>
                        <div class="menu-item-desc">Track materials and supplies</div>
                    </div>
                </a>
                
                <a href="{{ url_for('checklist_management') }}" class="menu-item">
                    <i class="fas fa-tasks text-secondary"></i>
                    <div>
                        <div class="menu-item-text">Job Checklists</div>
                        <div class="menu-item-desc">Track job completion</div>
                    </div>
                </a>
                
                <a href="{{ url_for('unified_scheduler_dashboard') }}" class="menu-item">
                    <i class="fas fa-calendar-week text-primary"></i>
                    <div>
                        <div class="menu-item-text">Advanced Scheduler</div>
                        <div class="menu-item-desc">Comprehensive scheduling tools</div>
                    </div>
                </a>
            </div>

            <!-- Analytics Section -->
            <div class="menu-section">
                <div class="menu-section-title">Analytics & Intelligence</div>
                
                <a href="{{ url_for('analytics_dashboard') }}" class="menu-item">
                    <i class="fas fa-chart-bar text-info"></i>
                    <div>
                        <div class="menu-item-text">Analytics Dashboard</div>
                        <div class="menu-item-desc">Business performance metrics</div>
                    </div>
                </a>
                
                <a href="{{ url_for('business_intelligence_dashboard') }}" class="menu-item">
                    <i class="fas fa-brain text-success"></i>
                    <div>
                        <div class="menu-item-text">Business Intelligence</div>
                        <div class="menu-item-desc">Strategic insights and recommendations</div>
                    </div>
                </a>
                
                <a href="{{ url_for('ml_insights_dashboard') }}" class="menu-item">
                    <i class="fas fa-magic text-warning"></i>
                    <div>
                        <div class="menu-item-text">ML Insights</div>
                        <div class="menu-item-desc">AI-powered analytics</div>
                    </div>
                </a>
                
                <a href="{{ url_for('integrated_analytics') }}" class="menu-item">
                    <i class="fas fa-chart-line text-dark"></i>
                    <div>
                        <div class="menu-item-text">Analytics Command</div>
                        <div class="menu-item-desc">Integrated analytics platform</div>
                    </div>
                </a>
            </div>

            <!-- Advanced Tools Section -->
            <div class="menu-section">
                <div class="menu-section-title">Advanced Tools</div>
                
                <a href="{{ url_for('advanced_scheduler_dashboard') }}" class="menu-item">
                    <i class="fas fa-calendar-alt text-dark"></i>
                    <div>
                        <div class="menu-item-text">Advanced Scheduler</div>
                        <div class="menu-item-desc">Professional scheduling interface</div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Content -->
    <div class="row g-4">
        <!-- Full Width - Weekly Schedule -->
        <div class="col-12">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-calendar-alt me-2"></i>
                        Extended Schedule (4 Weeks)
                    </h5>
                    {% if all_weeks and all_weeks|length > 0 %}
                    <small>{{ all_weeks[0]['dates'][0].strftime('%B %d') }} - {{ all_weeks[-1]['dates'][6].strftime('%B %d, %Y') }}</small>
                    {% else %}
                    <small>Schedule View</small>
                    {% endif %}
                </div>
                <div class="card-body p-0">
                    <!-- Calendar Status Badges -->
                    <div class="p-3 border-bottom">
                        <div class="row g-2">
                            <div class="col-6 col-md-3">
                                <span class="badge bg-success d-block py-2">
                                    <i class="fas fa-dollar-sign me-1"></i>
                                    Invoice Management
                                </span>
                            </div>
                            <div class="col-6 col-md-3">
                                <span class="badge bg-dark d-block py-2">
                                    <i class="fas fa-users me-1"></i>
                                    Staff Management
                                </span>
                            </div>
                            <div class="col-6 col-md-3">
                                <span class="badge bg-info d-block py-2">
                                    <i class="fas fa-tasks me-1"></i>
                                    Job Tracking
                                </span>
                            </div>
                            <div class="col-6 col-md-3">
                                <span class="badge bg-warning d-block py-2">
                                    <i class="fas fa-chart-bar me-1"></i>
                                    Financial Reports
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Extended Calendar - 4 Weeks -->
                    <div class="p-3">
                        {% if all_weeks and all_weeks|length > 0 %}
                            {% for week in all_weeks %}
                            <div class="mb-4 {% if not loop.last %}border-bottom pb-3{% endif %}">
                                <!-- Week Header -->
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="fw-bold mb-0 {{ 'text-primary' if week.is_current else 'text-muted' }}">
                                        <i class="fas fa-calendar-week me-1"></i>
                                        Week {{ week.week_number }} 
                                        {% if week.is_current %}
                                            <span class="badge bg-primary ms-2">Current</span>
                                        {% endif %}
                                    </h6>
                                    <small class="text-muted">
                                        {{ week.dates[0].strftime('%b %d') }} - {{ week.dates[6].strftime('%b %d') }}
                                    </small>
                                </div>
                                
                                <!-- Week Days -->
                                <div class="row g-2">
                                    {% for date in week.dates %}
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 {{ 'bg-primary text-white' if date.strftime('%Y-%m-%d') == today else 'bg-light' }}">
                                                <div class="fw-bold small">{{ date.strftime('%a') }}</div>
                                                <div class="h6 mb-0">{{ date.strftime('%d') }}</div>
                                            </div>
                                            <div class="day-content p-1" style="min-height: 60px;">
                                                {% set day_appointments = [] %}
                                                {% for appointment in all_appointments %}
                                                    {% if appointment.date == date.strftime('%Y-%m-%d') %}
                                                        {% set _ = day_appointments.append(appointment) %}
                                                    {% endif %}
                                                {% endfor %}
                                                
                                                {% if day_appointments %}
                                                    {% for appointment in day_appointments %}
                                                    <div class="appointment-block bg-success text-white p-1 mb-1 rounded" style="font-size: 0.7rem; line-height: 1.1;">
                                                        <div class="fw-bold">{{ appointment.time }}</div>
                                                        <div>{{ appointment.service[:20] }}{% if appointment.service|length > 20 %}...{% endif %}</div>
                                                    </div>
                                                    {% endfor %}
                                                {% else %}
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                        <div class="text-center py-4">
                            <p class="text-muted">Schedule loading...</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Side Menu Functionality
function toggleSideMenu() {
    const sideMenu = document.getElementById('sideMenu');
    const overlay = document.getElementById('sideMenuOverlay');
    const toggleBtn = document.getElementById('quickActionsToggle');
    
    if (sideMenu.classList.contains('active')) {
        closeSideMenu();
    } else {
        openSideMenu();
    }
}

function openSideMenu() {
    const sideMenu = document.getElementById('sideMenu');
    const overlay = document.getElementById('sideMenuOverlay');
    const toggleBtn = document.getElementById('quickActionsToggle');
    
    sideMenu.classList.add('active');
    overlay.style.display = 'block';
    toggleBtn.classList.add('active');
    
    // Change icon to close
    const icon = toggleBtn.querySelector('i');
    icon.className = 'fas fa-times';
    
    // Prevent body scroll when menu is open
    document.body.style.overflow = 'hidden';
}

function closeSideMenu() {
    const sideMenu = document.getElementById('sideMenu');
    const overlay = document.getElementById('sideMenuOverlay');
    const toggleBtn = document.getElementById('quickActionsToggle');
    
    sideMenu.classList.remove('active');
    overlay.style.display = 'none';
    toggleBtn.classList.remove('active');
    
    // Change icon back to bolt
    const icon = toggleBtn.querySelector('i');
    icon.className = 'fas fa-bolt';
    
    // Restore body scroll
    document.body.style.overflow = '';
}

// Close menu when pressing Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeSideMenu();
    }
});

// Close menu when clicking on menu items (for better UX)
document.addEventListener('DOMContentLoaded', function() {
    const menuItems = document.querySelectorAll('.menu-item');
    menuItems.forEach(item => {
        item.addEventListener('click', function() {
            // Small delay to allow the navigation to start
            setTimeout(closeSideMenu, 100);
        });
    });
});
</script>
{% endblock %}