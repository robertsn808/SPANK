<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
    <meta name="format-detection" content="telephone=yes">
    <meta name="theme-color" content="#2c3e50">
    <title>Admin Dashboard - SPANKKS Construction</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/mobile-responsive.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    
</head>
<body class="admin-body">
    <!-- Enhanced UX Components removed to prevent unwanted form display -->
    <!-- Medium Priority Enhancements Implementation -->
<style>
/* Advanced Search and Filtering */
.search-filter-bar {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    border: 1px solid #e1e5e9;
}

.search-input-group {
    position: relative;
    display: flex;
    align-items: center;
}

.search-input {
    flex: 1;
    padding: 12px 45px 12px 16px;
    border: 2px solid #e1e5e9;
    border-radius: 8px;
    font-size: 16px;
    transition: all 0.2s ease;
}

.search-input:focus {
    border-color: #007bff;
    outline: none;
    box-shadow: 0 0 0 0.2rem rgba(0,123,255,.15);
}

.search-icon {
    position: absolute;
    right: 15px;
    color: #6c757d;
    font-size: 16px;
}

.filter-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 15px;
}

.filter-chip {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 20px;
    padding: 6px 12px;
    font-size: 12px;
    color: #495057;
    cursor: pointer;
    transition: all 0.2s ease;
}

.filter-chip:hover {
    background: #e9ecef;
}

.filter-chip.active {
    background: #007bff;
    color: white;
    border-color: #007bff;
}

.quick-filters {
    display: flex;
    gap: 10px;
    margin-top: 10px;
    flex-wrap: wrap;
}

.quick-filter {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.quick-filter:hover {
    background: #e9ecef;
    transform: translateY(-1px);
}

.quick-filter.active {
    background: #28a745;
    color: white;
    border-color: #28a745;
}

/* Bulk Actions */
.bulk-actions-bar {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 20px;
    display: none;
    align-items: center;
    justify-content: space-between;
}

.bulk-actions-bar.active {
    display: flex;
}

.bulk-selection-info {
    font-size: 14px;
    color: #495057;
    font-weight: 500;
}

.bulk-actions {
    display: flex;
    gap: 8px;
}

.bulk-action-btn {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 6px;
    padding: 6px 12px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.bulk-action-btn:hover {
    background: #f8f9fa;
    border-color: #adb5bd;
}

.bulk-action-btn.danger:hover {
    background: #dc3545;
    color: white;
    border-color: #dc3545;
}

/* Advanced Data Tables */
.data-table-container {
    background: white;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    border: 1px solid #e1e5e9;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table th {
    background: #f8f9fa;
    padding: 16px 12px;
    text-align: left;
    font-weight: 600;
    color: #495057;
    border-bottom: 2px solid #dee2e6;
    position: relative;
    cursor: pointer;
    user-select: none;
}

.data-table th:hover {
    background: #e9ecef;
}

.data-table th.sortable::after {
    content: '\f0dc';
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    position: absolute;
    right: 8px;
    color: #adb5bd;
    font-size: 12px;
}

.data-table th.sort-asc::after {
    content: '\f0de';
    color: #007bff;
}

.data-table th.sort-desc::after {
    content: '\f0dd';
    color: #007bff;
}

.data-table td {
    padding: 12px;
    border-bottom: 1px solid #f0f0f0;
    vertical-align: middle;
}

.data-table tr:hover {
    background: #f8f9fa;
}

.row-checkbox {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.row-actions {
    display: flex;
    gap: 4px;
    opacity: 0;
    transition: opacity 0.2s ease;
}

.data-table tr:hover .row-actions {
    opacity: 1;
}

.row-action-btn {
    width: 28px;
    height: 28px;
    border: none;
    border-radius: 4px;
    background: #f8f9fa;
    color: #6c757d;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
}

.row-action-btn:hover {
    background: #007bff;
    color: white;
    transform: scale(1.1);
}

.row-action-btn.danger:hover {
    background: #dc3545;
}

/* Status Indicators */
.status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-indicator::before {
    content: '';
    width: 6px;
    height: 6px;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

.status-pending {
    background: #fff3cd;
    color: #856404;
}

.status-pending::before {
    background: #ffc107;
}

.status-confirmed {
    background: #d4edda;
    color: #155724;
}

.status-confirmed::before {
    background: #28a745;
}

.status-completed {
    background: #d1ecf1;
    color: #0c5460;
}

.status-completed::before {
    background: #17a2b8;
}

.status-overdue {
    background: #f8d7da;
    color: #721c24;
}

.status-overdue::before {
    background: #dc3545;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

/* Advanced Pagination */
.pagination-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 20px;
    background: #f8f9fa;
    border-top: 1px solid #dee2e6;
}

.pagination-info {
    font-size: 14px;
    color: #6c757d;
}

.pagination-controls {
    display: flex;
    align-items: center;
    gap: 8px;
}

.pagination-btn {
    width: 32px;
    height: 32px;
    border: 1px solid #dee2e6;
    background: white;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
}

.pagination-btn:hover {
    background: #f8f9fa;
    border-color: #adb5bd;
}

.pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.pagination-btn.active {
    background: #007bff;
    color: white;
    border-color: #007bff;
}

.page-size-selector {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: 16px;
}

.page-size-select {
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 13px;
}

/* Export and Import */
.export-import-bar {
    background: white;
    border: 1px solid #e1e5e9;
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.export-buttons {
    display: flex;
    gap: 8px;
}

.export-btn {
    background: #28a745;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 6px;
}

.export-btn:hover {
    background: #218838;
    transform: translateY(-1px);
}

.import-area {
    display: flex;
    align-items: center;
    gap: 12px;
}

.file-upload-btn {
    background: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 12px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.file-upload-btn:hover {
    background: #0056b3;
}

/* Advanced Modals */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 9999;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal-overlay.active {
    display: flex;
}

.modal-container {
    background: white;
    border-radius: 12px;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.2);
    animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.modal-header {
    padding: 20px 24px;
    border-bottom: 1px solid #e1e5e9;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-title {
    font-size: 18px;
    font-weight: 600;
    color: #495057;
    margin: 0;
}

.modal-close {
    width: 32px;
    height: 32px;
    border: none;
    background: #f8f9fa;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    background: #e9ecef;
}

.modal-body {
    padding: 24px;
    max-height: 60vh;
    overflow-y: auto;
}

.modal-footer {
    padding: 16px 24px;
    border-top: 1px solid #e1e5e9;
    display: flex;
    justify-content: flex-end;
    gap: 12px;
    background: #f8f9fa;
}

/* Real-time Updates */
.live-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 8px;
    background: #d4edda;
    border: 1px solid #c3e6cb;
    border-radius: 12px;
    font-size: 11px;
    color: #155724;
    font-weight: 500;
}

.live-indicator::before {
    content: '';
    width: 6px;
    height: 6px;
    background: #28a745;
    border-radius: 50%;
    animation: pulse 1s infinite;
}

.update-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #17a2b8;
    color: white;
    padding: 12px 16px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    z-index: 9998;
    transform: translateX(400px);
    transition: transform 0.3s ease;
}

.update-notification.show {
    transform: translateX(0);
}

/* Mobile Optimizations */
@media (max-width: 768px) {
    .search-filter-bar {
        padding: 15px;
    }
    
    .filter-chips {
        margin-top: 10px;
    }
    
    .bulk-actions-bar {
        flex-direction: column;
        gap: 10px;
        align-items: stretch;
    }
    
    .bulk-actions {
        justify-content: center;
    }
    
    .data-table-container {
        overflow-x: auto;
    }
    
    .data-table {
        min-width: 600px;
    }
    
    .pagination-container {
        flex-direction: column;
        gap: 12px;
        text-align: center;
    }
    
    .export-import-bar {
        flex-direction: column;
        gap: 12px;
    }
    
    .modal-container {
        margin: 10px;
        max-height: calc(100vh - 20px);
    }
    
    .modal-body {
        max-height: calc(70vh - 120px);
    }
}
</style>

<!-- Advanced Search and Filtering Component -->
<div class="search-filter-bar">
    <div class="search-input-group">
        <input type="text" class="search-input" placeholder="Search quotes, invoices, clients..." 
               onkeyup="performSearch(this.value)">
        <i class="fas fa-search search-icon"></i>
    </div>
    
    <div class="quick-filters">
        <div class="quick-filter active" onclick="setQuickFilter('all', this)">All Items</div>
        <div class="quick-filter" onclick="setQuickFilter('pending', this)">Pending</div>
        <div class="quick-filter" onclick="setQuickFilter('confirmed', this)">Confirmed</div>
        <div class="quick-filter" onclick="setQuickFilter('completed', this)">Completed</div>
        <div class="quick-filter" onclick="setQuickFilter('overdue', this)">Overdue</div>
    </div>
    
    <div class="filter-chips">
        <div class="filter-chip" onclick="toggleFilter('this-week', this)">This Week</div>
        <div class="filter-chip" onclick="toggleFilter('this-month', this)">This Month</div>
        <div class="filter-chip" onclick="toggleFilter('high-value', this)">High Value ($1000+)</div>
        <div class="filter-chip" onclick="toggleFilter('new-clients', this)">New Clients</div>
        <div class="filter-chip" onclick="toggleFilter('repeat-clients', this)">Repeat Clients</div>
    </div>
</div>

<!-- Bulk Actions Bar -->
<div class="bulk-actions-bar" id="bulkActionsBar">
    <div class="bulk-selection-info">
        <span id="selectedCount">0</span> items selected
    </div>
    <div class="bulk-actions">
        <button class="bulk-action-btn" onclick="bulkAction('mark-paid')">
            <i class="fas fa-check"></i> Mark as Paid
        </button>
        <button class="bulk-action-btn" onclick="bulkAction('send-reminders')">
            <i class="fas fa-envelope"></i> Send Reminders
        </button>
        <button class="bulk-action-btn" onclick="bulkAction('export-selected')">
            <i class="fas fa-download"></i> Export
        </button>
        <button class="bulk-action-btn danger" onclick="bulkAction('delete')">
            <i class="fas fa-trash"></i> Delete
        </button>
    </div>
</div>

<!-- Export/Import Bar -->
<div class="export-import-bar">
    <div class="export-buttons">
        <button class="export-btn" onclick="exportData('csv')">
            <i class="fas fa-file-csv"></i> Export CSV
        </button>
        <button class="export-btn" onclick="exportData('excel')">
            <i class="fas fa-file-excel"></i> Export Excel
        </button>
        <button class="export-btn" onclick="exportData('pdf')">
            <i class="fas fa-file-pdf"></i> Export PDF Report
        </button>
    </div>
    
    <div class="import-area">
        <span class="live-indicator">Live Updates Active</span>
        <input type="file" id="importFile" accept=".csv,.xlsx" style="display: none;" onchange="importData(this)">
        <button class="file-upload-btn" onclick="document.getElementById('importFile').click()">
            <i class="fas fa-upload"></i> Import Data
        </button>
    </div>
</div>

<!-- Advanced Data Table -->
<div class="data-table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th width="40">
                    <input type="checkbox" class="row-checkbox" onchange="selectAllRows(this)">
                </th>
                <th class="sortable" onclick="sortTable('id')">ID</th>
                <th class="sortable" onclick="sortTable('client')">Client</th>
                <th class="sortable" onclick="sortTable('service')">Service</th>
                <th class="sortable" onclick="sortTable('amount')">Amount</th>
                <th class="sortable" onclick="sortTable('status')">Status</th>
                <th class="sortable" onclick="sortTable('date')">Date</th>
                <th width="120">Actions</th>
            </tr>
        </thead>
        <tbody id="dataTableBody">
            <tr>
                <td><input type="checkbox" class="row-checkbox" onchange="toggleRowSelection(this)"></td>
                <td><strong>Q2025-001</strong></td>
                <td>Johnson Residence</td>
                <td>Kitchen Renovation</td>
                <td>$4,500.00</td>
                <td><span class="status-indicator status-confirmed">Confirmed</span></td>
                <td>Dec 15, 2024</td>
                <td>
                    <div class="row-actions">
                        <button class="row-action-btn" data-tooltip="View Details" onclick="viewItem('Q2025-001')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="row-action-btn" data-tooltip="Edit Quote" onclick="editItem('Q2025-001')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="row-action-btn" data-tooltip="Generate Invoice" onclick="generateInvoice('Q2025-001')">
                            <i class="fas fa-file-invoice"></i>
                        </button>
                        <button class="row-action-btn danger" data-tooltip="Delete" onclick="deleteItem('Q2025-001')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
            <tr>
                <td><input type="checkbox" class="row-checkbox" onchange="toggleRowSelection(this)"></td>
                <td><strong>I2025-001</strong></td>
                <td>Johnson Residence</td>
                <td>Kitchen Renovation</td>
                <td>$4,712.04</td>
                <td><span class="status-indicator status-completed">Paid</span></td>
                <td>Dec 22, 2024</td>
                <td>
                    <div class="row-actions">
                        <button class="row-action-btn" data-tooltip="View Invoice" onclick="viewItem('I2025-001')">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="row-action-btn" data-tooltip="Download PDF" onclick="downloadPDF('I2025-001')">
                            <i class="fas fa-download"></i>
                        </button>
                        <button class="row-action-btn" data-tooltip="Email Client" onclick="emailClient('I2025-001')">
                            <i class="fas fa-envelope"></i>
                        </button>
                        <button class="row-action-btn" data-tooltip="Record Payment" onclick="recordPayment('I2025-001')">
                            <i class="fas fa-credit-card"></i>
                        </button>
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    
    <!-- Pagination -->
    <div class="pagination-container">
        <div class="pagination-info">
            Showing 1-25 of 127 items
        </div>
        <div class="pagination-controls">
            <button class="pagination-btn" onclick="changePage('prev')" disabled>
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="pagination-btn active" onclick="changePage(1)">1</button>
            <button class="pagination-btn" onclick="changePage(2)">2</button>
            <button class="pagination-btn" onclick="changePage(3)">3</button>
            <span>...</span>
            <button class="pagination-btn" onclick="changePage(6)">6</button>
            <button class="pagination-btn" onclick="changePage('next')">
                <i class="fas fa-chevron-right"></i>
            </button>
            
            <div class="page-size-selector">
                <span>Show:</span>
                <select class="page-size-select" onchange="changePageSize(this.value)">
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- Advanced Modal -->
<div class="modal-overlay" id="advancedModal">
    <div class="modal-container">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">Item Details</h3>
            <button class="modal-close" onclick="closeModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body" id="modalBody">
            <!-- Dynamic content -->
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Close</button>
            <button class="btn btn-primary" id="modalActionBtn">Save Changes</button>
        </div>
    </div>
</div>

<!-- Real-time Update Notification -->
<div class="update-notification" id="updateNotification">
    <i class="fas fa-sync-alt"></i>
    <span id="updateMessage">Data updated successfully</span>
</div>

<script>
// Medium Priority Enhancement Functions
let selectedRows = new Set();
let currentSort = { column: null, direction: 'asc' };
let adminFilters = { quick: 'all', chips: new Set() };
let tablePagination = 1;
let pageSize = 25;

// Search and Filtering
function performSearch(searchTerm) {
    console.log('Searching for:', searchTerm);
    // Implement search logic
    updateTable();
}

function setQuickFilter(filter, element) {
    document.querySelectorAll('.quick-filter').forEach(el => el.classList.remove('active'));
    element.classList.add('active');
    adminFilters.quick = filter;
    updateTable();
}

function toggleFilter(filter, element) {
    element.classList.toggle('active');
    if (adminFilters.chips.has(filter)) {
        adminFilters.chips.delete(filter);
    } else {
        adminFilters.chips.add(filter);
    }
    updateTable();
}

// Bulk Actions
function selectAllRows(checkbox) {
    const rowCheckboxes = document.querySelectorAll('.data-table tbody .row-checkbox');
    selectedRows.clear();
    
    rowCheckboxes.forEach(cb => {
        cb.checked = checkbox.checked;
        if (checkbox.checked) {
            selectedRows.add(cb.closest('tr').querySelector('td:nth-child(2)').textContent.trim());
        }
    });
    
    updateBulkActionsBar();
}

function toggleRowSelection(checkbox) {
    const rowId = checkbox.closest('tr').querySelector('td:nth-child(2)').textContent.trim();
    
    if (checkbox.checked) {
        selectedRows.add(rowId);
    } else {
        selectedRows.delete(rowId);
    }
    
    updateBulkActionsBar();
}

function updateBulkActionsBar() {
    const bulkBar = document.getElementById('bulkActionsBar');
    const countSpan = document.getElementById('selectedCount');
    
    countSpan.textContent = selectedRows.size;
    
    if (selectedRows.size > 0) {
        bulkBar.classList.add('active');
    } else {
        bulkBar.classList.remove('active');
    }
}

function bulkAction(action) {
    if (selectedRows.size === 0) return;
    
    const actionMessages = {
        'mark-paid': 'mark selected items as paid',
        'send-reminders': 'send reminders for selected items',
        'export-selected': 'export selected items',
        'delete': 'delete selected items'
    };
    
    if (confirm(`Are you sure you want to ${actionMessages[action]}? This will affect ${selectedRows.size} items.`)) {
        console.log(`Performing ${action} on:`, Array.from(selectedRows));
        showUpdateNotification(`Successfully ${actionMessages[action].replace('delete', 'deleted')}`);
        
        // Clear selection after action
        selectedRows.clear();
        updateBulkActionsBar();
        document.querySelectorAll('.row-checkbox').forEach(cb => cb.checked = false);
    }
}

// Table Sorting
function sortTable(column) {
    const th = event.target;
    
    // Reset other columns
    document.querySelectorAll('.data-table th').forEach(header => {
        if (header !== th) {
            header.classList.remove('sort-asc', 'sort-desc');
        }
    });
    
    // Update current column
    if (currentSort.column === column) {
        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
    } else {
        currentSort.column = column;
        currentSort.direction = 'asc';
    }
    
    th.classList.remove('sort-asc', 'sort-desc');
    th.classList.add(`sort-${currentSort.direction}`);
    
    console.log(`Sorting by ${column} ${currentSort.direction}`);
    updateTable();
}

// Pagination
function changePage(page) {
    if (page === 'prev' && tablePagination > 1) {
        tablePagination--;
    } else if (page === 'next') {
        tablePagination++;
    } else if (typeof page === 'number') {
        tablePagination = page;
    }
    
    updateTable();
    updatePaginationButtons();
}

function changePageSize(size) {
    pageSize = parseInt(size);
    tablePagination = 1;
    updateTable();
    updatePaginationButtons();
}

function updatePaginationButtons() {
    document.querySelectorAll('.pagination-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.textContent == tablePagination) {
            btn.classList.add('active');
        }
    });
}

// Export/Import
function exportData(format) {
    console.log(`Exporting data as ${format}`);
    showUpdateNotification(`Preparing ${format.toUpperCase()} export...`);
    
    // Simulate export process
    setTimeout(() => {
        showUpdateNotification(`${format.toUpperCase()} export completed!`);
    }, 2000);
}

function importData(input) {
    const file = input.files[0];
    if (!file) return;
    
    console.log('Importing file:', file.name);
    showUpdateNotification('Processing import file...');
    
    // Simulate import process
    setTimeout(() => {
        showUpdateNotification('Import completed successfully!');
        updateTable();
    }, 3000);
}

// Modal Functions
function openModal(title, content, actionText = 'Save') {
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalBody').innerHTML = content;
    document.getElementById('modalActionBtn').textContent = actionText;
    document.getElementById('advancedModal').classList.add('active');
}

function closeModal() {
    document.getElementById('advancedModal').classList.remove('active');
}

// Row Actions
function viewItem(itemId) {
    const content = `
        <div class="item-details">
            <h5>Item: ${itemId}</h5>
            <p><strong>Status:</strong> Active</p>
            <p><strong>Created:</strong> ${new Date().toLocaleDateString()}</p>
            <p><strong>Last Modified:</strong> ${new Date().toLocaleDateString()}</p>
            <div class="mt-3">
                <h6>Recent Activity</h6>
                <ul class="list-unstyled">
                    <li class="mb-1"><small class="text-muted">${new Date().toLocaleString()}</small> - Item viewed</li>
                    <li class="mb-1"><small class="text-muted">${new Date().toLocaleString()}</small> - Status updated</li>
                </ul>
            </div>
        </div>
    `;
    openModal(`View ${itemId}`, content, 'Close');
}

function editItem(itemId) {
    const content = `
        <form>
            <div class="mb-3">
                <label class="form-label">Item Name</label>
                <input type="text" class="form-control" value="${itemId}">
            </div>
            <div class="mb-3">
                <label class="form-label">Status</label>
                <select class="form-control">
                    <option>Pending</option>
                    <option selected>Confirmed</option>
                    <option>Completed</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Notes</label>
                <textarea class="form-control" rows="3"></textarea>
            </div>
        </form>
    `;
    openModal(`Edit ${itemId}`, content, 'Save Changes');
}

function generateInvoice(itemId) {
    showUpdateNotification('Generating invoice...');
    setTimeout(() => {
        showUpdateNotification('Invoice generated successfully!');
    }, 2000);
}

function deleteItem(itemId) {
    if (confirm(`Are you sure you want to delete ${itemId}? This action cannot be undone.`)) {
        showUpdateNotification('Item deleted successfully');
        updateTable();
    }
}

function downloadPDF(itemId) {
    showUpdateNotification('Preparing PDF download...');
    setTimeout(() => {
        showUpdateNotification('PDF download started');
    }, 1000);
}

function emailClient(itemId) {
    showUpdateNotification('Sending email to client...');
    setTimeout(() => {
        showUpdateNotification('Email sent successfully!');
    }, 2000);
}

function recordPayment(itemId) {
    const content = `
        <form>
            <div class="mb-3">
                <label class="form-label">Payment Amount</label>
                <div class="input-group">
                    <span class="input-group-text">$</span>
                    <input type="number" class="form-control" step="0.01" placeholder="0.00">
                </div>
            </div>
            <div class="mb-3">
                <label class="form-label">Payment Method</label>
                <select class="form-control">
                    <option>Cash</option>
                    <option>Check</option>
                    <option>Venmo</option>
                    <option>Zelle</option>
                    <option>Bank Transfer</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Payment Date</label>
                <input type="date" class="form-control" value="${new Date().toISOString().split('T')[0]}">
            </div>
        </form>
    `;
    openModal(`Record Payment - ${itemId}`, content, 'Record Payment');
}

// Real-time Updates
function showUpdateNotification(message) {
    const notification = document.getElementById('updateNotification');
    document.getElementById('updateMessage').textContent = message;
    notification.classList.add('show');
    
    setTimeout(() => {
        notification.classList.remove('show');
    }, 3000);
}

function updateTable() {
    console.log('Updating table with filters:', adminFilters, 'Sort:', currentSort, 'Page:', tablePagination);
    // Implement table update logic
    showUpdateNotification('Table updated');
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    updateTable();
    
    // Simulate real-time updates every 30 seconds
    setInterval(() => {
        if (Math.random() > 0.7) { // 30% chance of update
            showUpdateNotification('New data available');
        }
    }, 30000);
});

// Close modal when clicking overlay
document.getElementById('advancedModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeModal();
    }
});
</script>
    <!-- Comprehensive Notification and Keyboard Shortcut System -->
<style>
/* Notification Banner System */
.notification-banner {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 10000;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    font-size: 14px;
    font-weight: 500;
    transform: translateY(-100%);
    transition: transform 0.3s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.notification-banner.show {
    transform: translateY(0);
}

.notification-banner.info {
    background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
    color: white;
}

.notification-banner.success {
    background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
    color: white;
}

.notification-banner.warning {
    background: linear-gradient(135deg, #ffc107 0%, #e0a800 100%);
    color: #212529;
}

.notification-banner.error {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
}

.notification-content {
    display: flex;
    align-items: center;
    gap: 12px;
}

.notification-icon {
    font-size: 16px;
}

.notification-message {
    flex: 1;
}

.notification-actions {
    display: flex;
    gap: 8px;
    align-items: center;
}

.notification-action {
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.3);
    color: inherit;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
}

.notification-action:hover {
    background: rgba(255,255,255,0.3);
    color: inherit;
    text-decoration: none;
}

.notification-close {
    background: none;
    border: none;
    color: inherit;
    font-size: 18px;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: background-color 0.2s ease;
}

.notification-close:hover {
    background: rgba(255,255,255,0.2);
}

/* Toast Notifications */
.toast-container {
    position: fixed;
    top: 80px;
    right: 20px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-width: 400px;
}

.toast-notification {
    background: white;
    border-radius: 8px;
    padding: 16px;
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    border-left: 4px solid #007bff;
    transform: translateX(450px);
    transition: transform 0.3s ease;
    display: flex;
    align-items: flex-start;
    gap: 12px;
}

.toast-notification.show {
    transform: translateX(0);
}

.toast-notification.success {
    border-left-color: #28a745;
}

.toast-notification.warning {
    border-left-color: #ffc107;
}

.toast-notification.error {
    border-left-color: #dc3545;
}

.toast-icon {
    font-size: 18px;
    margin-top: 2px;
}

.toast-icon.success {
    color: #28a745;
}

.toast-icon.warning {
    color: #ffc107;
}

.toast-icon.error {
    color: #dc3545;
}

.toast-icon.info {
    color: #007bff;
}

.toast-content {
    flex: 1;
}

.toast-title {
    font-weight: 600;
    margin-bottom: 4px;
    color: #495057;
}

.toast-message {
    font-size: 14px;
    color: #6c757d;
    line-height: 1.4;
}

.toast-close {
    background: none;
    border: none;
    color: #adb5bd;
    font-size: 16px;
    cursor: pointer;
    padding: 2px;
    border-radius: 4px;
    transition: color 0.2s ease;
}

.toast-close:hover {
    color: #6c757d;
}

/* Keyboard Shortcuts Help */
.keyboard-shortcuts-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 10001;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.keyboard-shortcuts-overlay.show {
    display: flex;
}

.shortcuts-modal {
    background: white;
    border-radius: 12px;
    max-width: 700px;
    width: 100%;
    max-height: 80vh;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
}

.shortcuts-header {
    padding: 20px 24px;
    border-bottom: 1px solid #e1e5e9;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f8f9fa;
}

.shortcuts-title {
    font-size: 18px;
    font-weight: 600;
    color: #495057;
    margin: 0;
}

.shortcuts-body {
    padding: 24px;
    max-height: 60vh;
    overflow-y: auto;
}

.shortcuts-section {
    margin-bottom: 24px;
}

.shortcuts-section-title {
    font-size: 16px;
    font-weight: 600;
    color: #495057;
    margin-bottom: 12px;
    padding-bottom: 6px;
    border-bottom: 1px solid #e1e5e9;
}

.shortcut-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #f8f9fa;
}

.shortcut-item:last-child {
    border-bottom: none;
}

.shortcut-description {
    color: #495057;
    font-size: 14px;
}

.shortcut-keys {
    display: flex;
    gap: 4px;
}

.shortcut-key {
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    padding: 4px 8px;
    font-size: 12px;
    font-family: monospace;
    color: #495057;
    min-width: 24px;
    text-align: center;
}

/* Status Bar */
.status-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #343a40;
    color: white;
    padding: 8px 20px;
    font-size: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    z-index: 1000;
}

.status-left {
    display: flex;
    gap: 20px;
    align-items: center;
}

.status-right {
    display: flex;
    gap: 15px;
    align-items: center;
}

.status-item {
    display: flex;
    align-items: center;
    gap: 6px;
}

.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #28a745;
    animation: pulse 2s infinite;
}

.status-indicator.warning {
    background: #ffc107;
}

.status-indicator.error {
    background: #dc3545;
}

/* Mobile Optimizations */
@media (max-width: 768px) {
    .notification-banner {
        padding: 10px 15px;
        font-size: 13px;
    }
    
    .notification-actions {
        flex-direction: column;
        gap: 4px;
    }
    
    .toast-container {
        top: 60px;
        right: 10px;
        left: 10px;
        max-width: none;
    }
    
    .toast-notification {
        transform: translateY(-100px);
    }
    
    .toast-notification.show {
        transform: translateY(0);
    }
    
    .shortcuts-modal {
        margin: 10px;
        max-height: calc(100vh - 20px);
    }
    
    .shortcuts-body {
        max-height: calc(80vh - 120px);
        padding: 16px;
    }
    
    .shortcut-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
    }
    
    .status-bar {
        flex-direction: column;
        gap: 4px;
        padding: 6px 15px;
    }
    
    .status-left,
    .status-right {
        gap: 12px;
    }
}
</style>

<!-- Notification Banner -->
<div class="notification-banner" id="notificationBanner">
    <div class="notification-content">
        <i class="notification-icon fas fa-info-circle"></i>
        <div class="notification-message" id="bannerMessage">
            System maintenance scheduled for tonight at 2 AM HST
        </div>
    </div>
    <div class="notification-actions">
        <a href="#" class="notification-action" onclick="viewMaintenanceDetails()">View Details</a>
        <button class="notification-close" onclick="closeBanner()">
            <i class="fas fa-times"></i>
        </button>
    </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer">
    <!-- Toasts will be dynamically added here -->
</div>

<!-- Keyboard Shortcuts Overlay -->
<div class="keyboard-shortcuts-overlay" id="shortcutsOverlay">
    <div class="shortcuts-modal">
        <div class="shortcuts-header">
            <h3 class="shortcuts-title">Keyboard Shortcuts</h3>
            <button class="notification-close" onclick="hideShortcuts()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="shortcuts-body">
            <div class="shortcuts-section">
                <h4 class="shortcuts-section-title">Navigation</h4>
                <div class="shortcut-item">
                    <span class="shortcut-description">Go to Dashboard</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">Alt</kbd>
                        <kbd class="shortcut-key">D</kbd>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-description">Go to Quotes</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">Alt</kbd>
                        <kbd class="shortcut-key">Q</kbd>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-description">Go to Invoices</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">Alt</kbd>
                        <kbd class="shortcut-key">I</kbd>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-description">Go to Calendar</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">Alt</kbd>
                        <kbd class="shortcut-key">C</kbd>
                    </div>
                </div>
            </div>
            
            <div class="shortcuts-section">
                <h4 class="shortcuts-section-title">Actions</h4>
                <div class="shortcut-item">
                    <span class="shortcut-description">Create New Quote</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">Ctrl</kbd>
                        <kbd class="shortcut-key">N</kbd>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-description">Search</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">Ctrl</kbd>
                        <kbd class="shortcut-key">K</kbd>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-description">Save Form</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">Ctrl</kbd>
                        <kbd class="shortcut-key">S</kbd>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-description">Cancel/Go Back</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">Esc</kbd>
                    </div>
                </div>
            </div>
            
            <div class="shortcuts-section">
                <h4 class="shortcuts-section-title">Table Operations</h4>
                <div class="shortcut-item">
                    <span class="shortcut-description">Select All</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">Ctrl</kbd>
                        <kbd class="shortcut-key">A</kbd>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-description">Delete Selected</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">Del</kbd>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-description">Export Data</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">Ctrl</kbd>
                        <kbd class="shortcut-key">E</kbd>
                    </div>
                </div>
            </div>
            
            <div class="shortcuts-section">
                <h4 class="shortcuts-section-title">Help</h4>
                <div class="shortcut-item">
                    <span class="shortcut-description">Show Shortcuts</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">?</kbd>
                    </div>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-description">Toggle Help Mode</span>
                    <div class="shortcut-keys">
                        <kbd class="shortcut-key">H</kbd>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Status Bar (Admin and Portal Only) -->
<script>
// Check if current page should show status bar
if (window.location.pathname.startsWith('/admin/') || window.location.pathname.startsWith('/portal/')) {
    document.write(`
        <div class="status-bar">
            <div class="status-left">
                <div class="status-item">
                    <div class="status-indicator" id="connectionStatus"></div>
                    <span>Connected</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-clock"></i>
                    <span id="currentTime">--:-- --</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-sync-alt"></i>
                    <span>Last sync: <span id="lastSync">--:--</span></span>
                </div>
            </div>
            <div class="status-right">
                <div class="status-item">
                    <i class="fas fa-user"></i>
                    <span>Admin User</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-keyboard"></i>
                    <span>Press ? for shortcuts</span>
                </div>
            </div>
        </div>
    `);
}
</script>

<script>
// Notification System JavaScript
class NotificationSystem {
    constructor() {
        this.toastContainer = document.getElementById('toastContainer');
        this.banner = document.getElementById('notificationBanner');
        this.toastCounter = 0;
        this.initializeKeyboardShortcuts();
        this.initializeStatusBar();
    }
    
    // Banner Notifications
    showBanner(message, type = 'info', actions = null, duration = 0) {
        const banner = this.banner;
        const messageEl = document.getElementById('bannerMessage');
        const actionsEl = banner.querySelector('.notification-actions');
        
        // Update content
        messageEl.textContent = message;
        banner.className = `notification-banner ${type}`;
        
        // Update icon
        const iconEl = banner.querySelector('.notification-icon');
        const icons = {
            info: 'fas fa-info-circle',
            success: 'fas fa-check-circle',
            warning: 'fas fa-exclamation-triangle',
            error: 'fas fa-times-circle'
        };
        iconEl.className = `notification-icon ${icons[type] || icons.info}`;
        
        // Update actions
        if (actions) {
            const actionButtons = actions.map(action => 
                `<a href="#" class="notification-action" onclick="${action.handler}">${action.text}</a>`
            ).join('');
            actionsEl.innerHTML = actionButtons + actionsEl.querySelector('.notification-close').outerHTML;
        }
        
        // Show banner
        banner.classList.add('show');
        
        // Auto-hide if duration specified
        if (duration > 0) {
            setTimeout(() => this.hideBanner(), duration);
        }
    }
    
    hideBanner() {
        this.banner.classList.remove('show');
    }
    
    // Toast Notifications
    showToast(title, message, type = 'info', duration = 5000) {
        const toastId = `toast-${++this.toastCounter}`;
        const toast = document.createElement('div');
        toast.className = `toast-notification ${type}`;
        toast.id = toastId;
        
        const icons = {
            info: 'fas fa-info-circle',
            success: 'fas fa-check-circle',
            warning: 'fas fa-exclamation-triangle',
            error: 'fas fa-times-circle'
        };
        
        toast.innerHTML = `
            <i class="toast-icon ${type} ${icons[type] || icons.info}"></i>
            <div class="toast-content">
                <div class="toast-title">${title}</div>
                <div class="toast-message">${message}</div>
            </div>
            <button class="toast-close" onclick="notificationSystem.hideToast('${toastId}')">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        this.toastContainer.appendChild(toast);
        
        // Trigger animation
        setTimeout(() => toast.classList.add('show'), 100);
        
        // Auto-remove
        if (duration > 0) {
            setTimeout(() => this.hideToast(toastId), duration);
        }
        
        return toastId;
    }
    
    hideToast(toastId) {
        const toast = document.getElementById(toastId);
        if (toast) {
            toast.classList.remove('show');
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 300);
        }
    }
    
    // Keyboard Shortcuts
    initializeKeyboardShortcuts() {
        document.addEventListener('keydown', (e) => {
            // Don't trigger shortcuts when typing in inputs
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                return;
            }
            
            const key = e.key.toLowerCase();
            const ctrl = e.ctrlKey || e.metaKey;
            const alt = e.altKey;
            
            // Show shortcuts help
            if (key === '?' && !ctrl && !alt) {
                this.showShortcuts();
                e.preventDefault();
                return;
            }
            
            // Navigation shortcuts
            if (alt && !ctrl) {
                switch (key) {
                    case 'd':
                        window.location.href = '/admin/dashboard';
                        e.preventDefault();
                        break;
                    case 'q':
                        window.location.href = '/admin/quotes';
                        e.preventDefault();
                        break;
                    case 'i':
                        window.location.href = '/admin/invoices';
                        e.preventDefault();
                        break;
                    case 'c':
                        window.location.href = '/admin/scheduler';
                        e.preventDefault();
                        break;
                }
            }
            
            // Action shortcuts
            if (ctrl && !alt) {
                switch (key) {
                    case 'n':
                        window.location.href = '/admin/quote-builder';
                        e.preventDefault();
                        break;
                    case 'k':
                        this.focusSearch();
                        e.preventDefault();
                        break;
                    case 's':
                        this.saveCurrentForm();
                        e.preventDefault();
                        break;
                    case 'a':
                        this.selectAllTableRows();
                        e.preventDefault();
                        break;
                    case 'e':
                        this.exportData();
                        e.preventDefault();
                        break;
                }
            }
            
            // Other shortcuts
            if (key === 'escape') {
                this.handleEscape();
            } else if (key === 'delete' && !ctrl && !alt) {
                this.deleteSelected();
                e.preventDefault();
            } else if (key === 'h' && !ctrl && !alt) {
                this.toggleHelpMode();
                e.preventDefault();
            }
        });
    }
    
    showShortcuts() {
        document.getElementById('shortcutsOverlay').classList.add('show');
    }
    
    hideShortcuts() {
        document.getElementById('shortcutsOverlay').classList.remove('show');
    }
    
    focusSearch() {
        const searchInput = document.querySelector('.search-input, input[type="search"]');
        if (searchInput) {
            searchInput.focus();
            searchInput.select();
        }
    }
    
    saveCurrentForm() {
        const form = document.querySelector('form');
        if (form) {
            const submitBtn = form.querySelector('button[type="submit"], .btn-save');
            if (submitBtn) {
                submitBtn.click();
            }
        }
    }
    
    selectAllTableRows() {
        const selectAllCheckbox = document.querySelector('thead .row-checkbox');
        if (selectAllCheckbox) {
            selectAllCheckbox.checked = true;
            selectAllCheckbox.dispatchEvent(new Event('change'));
        }
    }
    
    deleteSelected() {
        const bulkDeleteBtn = document.querySelector('.bulk-action-btn.danger');
        if (bulkDeleteBtn && bulkDeleteBtn.offsetParent !== null) {
            bulkDeleteBtn.click();
        }
    }
    
    exportData() {
        const exportBtn = document.querySelector('.export-btn');
        if (exportBtn) {
            exportBtn.click();
        }
    }
    
    handleEscape() {
        // Close modals
        if (document.getElementById('shortcutsOverlay').classList.contains('show')) {
            this.hideShortcuts();
            return;
        }
        
        // Cancel forms or go back
        const cancelBtn = document.querySelector('.btn-cancel');
        if (cancelBtn) {
            cancelBtn.click();
        } else {
            window.history.back();
        }
    }
    
    toggleHelpMode() {
        document.body.classList.toggle('help-mode');
        if (document.body.classList.contains('help-mode')) {
            this.showToast('Help Mode', 'Hover over elements to see helpful tips', 'info', 3000);
        } else {
            this.showToast('Help Mode', 'Help mode disabled', 'info', 2000);
        }
    }
    
    // Status Bar (Admin and Portal Only)
    initializeStatusBar() {
        // Only initialize status bar on admin and portal pages
        if (!window.location.pathname.startsWith('/admin/') && !window.location.pathname.startsWith('/portal/')) {
            return;
        }
        
        this.updateTime();
        this.updateLastSync();
        
        // Update time every second
        setInterval(() => this.updateTime(), 1000);
        
        // Update sync status every 30 seconds
        setInterval(() => this.updateLastSync(), 30000);
        
        // Monitor connection status
        this.monitorConnection();
    }
    
    updateTime() {
        const timeElement = document.getElementById('currentTime');
        if (!timeElement) return;
        
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', {
            timeZone: 'Pacific/Honolulu',
            hour12: true,
            hour: 'numeric',
            minute: '2-digit'
        });
        timeElement.textContent = timeString + ' HST';
    }
    
    updateLastSync() {
        const syncElement = document.getElementById('lastSync');
        if (!syncElement) return;
        
        const now = new Date();
        const timeString = now.toLocaleTimeString('en-US', {
            hour12: true,
            hour: 'numeric',
            minute: '2-digit'
        });
        syncElement.textContent = timeString;
    }
    
    monitorConnection() {
        const statusIndicator = document.getElementById('connectionStatus');
        if (!statusIndicator) return;
        
        const statusText = statusIndicator.nextElementSibling;
        
        // Check connection status
        const updateConnectionStatus = () => {
            if (navigator.onLine) {
                statusIndicator.className = 'status-indicator';
                statusText.textContent = 'Connected';
            } else {
                statusIndicator.className = 'status-indicator error';
                statusText.textContent = 'Offline';
            }
        };
        
        window.addEventListener('online', updateConnectionStatus);
        window.addEventListener('offline', updateConnectionStatus);
        updateConnectionStatus();
        
        // Periodic connection check
        setInterval(() => {
            fetch('/api/health-check', { method: 'HEAD' })
                .then(() => {
                    statusIndicator.className = 'status-indicator';
                    statusText.textContent = 'Connected';
                })
                .catch(() => {
                    statusIndicator.className = 'status-indicator warning';
                    statusText.textContent = 'Connection Issues';
                });
        }, 60000);
    }
}

// Global notification functions
function showNotification(title, message, type = 'info') {
    return notificationSystem.showToast(title, message, type);
}

function showBanner(message, type = 'info', actions = null, duration = 0) {
    notificationSystem.showBanner(message, type, actions, duration);
}

function closeBanner() {
    notificationSystem.hideBanner();
}

function hideShortcuts() {
    notificationSystem.hideShortcuts();
}

function viewMaintenanceDetails() {
    notificationSystem.showToast(
        'Maintenance Schedule',
        'System maintenance will begin at 2:00 AM HST and is expected to last 2 hours. All services will be temporarily unavailable.',
        'info',
        8000
    );
}

// Initialize notification system
const notificationSystem = new NotificationSystem();

// Example notifications on page load
document.addEventListener('DOMContentLoaded', function() {
    // Show welcome notification only on admin pages
    if (window.location.pathname.startsWith('/admin/')) {
        setTimeout(() => {
            notificationSystem.showToast(
                'Welcome Back!',
                'All systems are running normally. You have 3 new quotes pending review.',
                'success',
                4000
            );
        }, 1000);
    }
    
    // Show banner for important updates
    if (Math.random() > 0.7) { // 30% chance to show maintenance banner
        setTimeout(() => {
            notificationSystem.showBanner(
                'System maintenance scheduled for tonight at 2 AM HST',
                'info',
                [{ text: 'View Details', handler: 'viewMaintenanceDetails()' }]
            );
        }, 2000);
    }
});

// Close shortcuts overlay when clicking outside
document.getElementById('shortcutsOverlay').addEventListener('click', function(e) {
    if (e.target === this) {
        hideShortcuts();
    }
});
</script>
    <!-- Admin Header with Hamburger Navigation -->
    <header class="admin-header bg-success text-white py-3 shadow-sm">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <img src="/static/images/spank-logo.png" alt="SPANKKS Logo" height="32" class="me-2">
                    <h4 class="mb-0">SPANKKS Admin</h4>
                </div>
                
                <!-- Hamburger Menu Button -->
                <button class="btn btn-outline-light d-md-none" type="button" data-bs-toggle="collapse" data-bs-target="#adminNavbar" aria-controls="adminNavbar" aria-expanded="false" aria-label="Toggle navigation">
                    <i class="fas fa-bars"></i>
                </button>
                
                <!-- Desktop Navigation -->
                <nav class="admin-nav d-none d-md-flex">
                    <a href="/admin/dashboard" class="btn btn-outline-light btn-sm me-1">
                        <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                    </a>
                    <a href="/admin/scheduler" class="btn btn-outline-light btn-sm me-1">
                        <i class="fas fa-calendar-alt me-1"></i>Scheduler
                    </a>
                    <a href="/admin/inquiries" class="btn btn-outline-light btn-sm me-1">
                        <i class="fas fa-inbox me-1"></i>Inquiries
                    </a>
                    <a href="/admin/staff" class="btn btn-outline-light btn-sm me-1">
                        <i class="fas fa-users me-1"></i>Staff
                    </a>
                    <a href="/admin/logout" class="btn btn-outline-light btn-sm">
                        <i class="fas fa-sign-out-alt me-1"></i>Logout
                    </a>
                </nav>
            </div>
            
            <!-- Mobile Navigation Collapse -->
            <div class="collapse mt-3" id="adminNavbar">
                <nav class="admin-mobile-nav d-flex flex-column gap-2">
                    <a href="/admin/dashboard" class="btn btn-outline-light w-100 text-start">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                    <a href="/admin/scheduler" class="btn btn-outline-light w-100 text-start">
                        <i class="fas fa-calendar-alt me-2"></i>Scheduler
                    </a>
                    <a href="/admin/inquiries" class="btn btn-outline-light w-100 text-start">
                        <i class="fas fa-inbox me-2"></i>Inquiries
                    </a>
                    <a href="/admin/staff" class="btn btn-outline-light w-100 text-start">
                        <i class="fas fa-users me-2"></i>Staff
                    </a>
                    <a href="/admin/logout" class="btn btn-outline-light w-100 text-start">
                        <i class="fas fa-sign-out-alt me-2"></i>Logout
                    </a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="admin-main">
        
<style>
.calendar-day-card {
    border: 1px solid #dee2e6;
    border-radius: 8px;
    background: white;
    transition: all 0.2s ease;
    height: 100%;
}
.calendar-day-card:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.day-header {
    border-radius: 8px 8px 0 0;
    border-bottom: 1px solid #dee2e6;
}
.appointment-block {
    font-size: 0.75rem;
    line-height: 1.2;
}

/* Drag and Drop Styles */
.draggable-appointment {
    transition: all 0.2s ease;
    user-select: none;
}

.draggable-appointment:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.draggable-appointment.dragging {
    opacity: 0.6;
    transform: rotate(3deg) scale(1.05);
    z-index: 1000;
}

.drop-zone.drag-over {
    border: 2px dashed #007bff;
    background-color: rgba(0, 123, 255, 0.1);
    border-radius: 4px;
}

.drop-zone.drag-enter {
    background-color: rgba(40, 167, 69, 0.1);
    border: 2px dashed #28a745;
}

/* Side Menu Styles */
.side-menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1040;
    display: none;
}

.side-menu {
    position: fixed;
    top: 0;
    right: -350px;
    width: 350px;
    height: 100%;
    background: white;
    box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
    z-index: 1050;
    transition: right 0.3s ease;
    overflow-y: auto;
}

.side-menu.active {
    right: 0;
}

.side-menu-header {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    padding: 1rem;
    position: sticky;
    top: 0;
    z-index: 10;
}

.side-menu-close {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    float: right;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.side-menu-content {
    padding: 1rem;
}

.menu-section {
    margin-bottom: 1.5rem;
}

.menu-section-title {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #6c757d;
    margin-bottom: 0.75rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #dee2e6;
}

.menu-item {
    display: flex;
    align-items: center;
    padding: 0.75rem;
    color: #495057;
    text-decoration: none;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    transition: all 0.2s ease;
}

.menu-item:hover {
    background: #f8f9fa;
    color: #28a745;
    text-decoration: none;
    transform: translateX(5px);
}

.menu-item i {
    width: 20px;
    margin-right: 0.75rem;
    font-size: 1rem;
}

.menu-item-text {
    font-weight: 500;
}

.menu-item-desc {
    font-size: 0.75rem;
    color: #6c757d;
    margin-top: 0.25rem;
}

.quick-actions-toggle {
    position: fixed;
    top: 50%;
    right: 20px;
    transform: translateY(-50%);
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    border: none;
    border-radius: 50%;
    width: 60px;
    height: 60px;
    font-size: 1.5rem;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 1030;
}

.quick-actions-toggle:hover {
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
}

.quick-actions-toggle.active {
    background: linear-gradient(135deg, #dc3545, #e74c3c);
}

@media (max-width: 768px) {
    .side-menu {
        width: 100%;
        right: -100%;
    }
    
    .calendar-day-card {
        margin-bottom: 0.5rem;
    }
    
    .quick-actions-toggle {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
        right: 15px;
    }
}
</style>
<div class="container-fluid py-3">
    <!-- Stats Cards Row -->
    <div class="row g-3 mb-4">
        <div class="col-6 col-md-3">
            <div class="card text-center border-0 shadow-sm">
                <div class="card-body py-3">
                    <i class="fas fa-clipboard-list fa-2x text-primary mb-2"></i>
                    <h3 class="card-title h4 mb-1">0</h3>
                    <p class="card-text text-muted small">Total Requests</p>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card text-center border-0 shadow-sm" style="cursor: pointer;" onclick="showPendingDetails()">
                <div class="card-body py-3">
                    <i class="fas fa-coins fa-2x text-warning mb-2"></i>
                    <h3 class="card-title h4 mb-1">0</h3>
                    <p class="card-text text-muted small">Pending</p>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card text-center border-0 shadow-sm">
                <div class="card-body py-3">
                    <i class="fas fa-envelope fa-2x text-info mb-2"></i>
                    <h3 class="card-title h4 mb-1">0</h3>
                    <p class="card-text text-muted small">Messages</p>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card text-center border-0 shadow-sm">
                <div class="card-body py-3">
                    <i class="fas fa-calendar-week fa-2x text-success mb-2"></i>
                    <h3 class="card-title h4 mb-1">0</h3>
                    <p class="card-text text-muted small">This Week</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions Toggle Button -->
    <button class="quick-actions-toggle" id="quickActionsToggle" onclick="toggleSideMenu()">
        <i class="fas fa-bolt"></i>
    </button>

    <!-- Side Menu Overlay -->
    <div class="side-menu-overlay" id="sideMenuOverlay" onclick="closeSideMenu()"></div>

    <!-- Side Menu -->
    <div class="side-menu" id="sideMenu">
        <div class="side-menu-header">
            <h5 class="mb-0">
                <i class="fas fa-bolt me-2"></i>
                Quick Actions
            </h5>
            <button class="side-menu-close" onclick="closeSideMenu()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="side-menu-content">
            <!-- Core Business Section -->
            <div class="menu-section">
                <div class="menu-section-title">Core Business</div>
                
                <a href="/admin/enhanced-quote-builder" class="menu-item">
                    <i class="fas fa-file-invoice-dollar text-success"></i>
                    <div>
                        <div class="menu-item-text">Quote Builder</div>
                        <div class="menu-item-desc">Create professional quotes</div>
                    </div>
                </a>
                

                
                <a href="javascript:void(0)" onclick="showPaymentModal()" class="menu-item">
                    <i class="fas fa-dollar-sign text-warning"></i>
                    <div>
                        <div class="menu-item-text">Mark Payment</div>
                        <div class="menu-item-desc">Track invoice payments</div>
                    </div>
                </a>
                
                <a href="/admin/scheduler/unified" class="menu-item">
                    <i class="fas fa-calendar-alt text-info"></i>
                    <div>
                        <div class="menu-item-text">Enhanced Calendar</div>
                        <div class="menu-item-desc">Color-coded scheduling system</div>
                    </div>
                </a>
            </div>

            <!-- Operations Section -->
            <div class="menu-section">
                <div class="menu-section-title">Operations</div>
                
                <a href="/admin/staff" class="menu-item">
                    <i class="fas fa-hard-hat text-warning"></i>
                    <div>
                        <div class="menu-item-text">Staff Management</div>
                        <div class="menu-item-desc">Manage crew and assignments</div>
                    </div>
                </a>
                
                <a href="/admin/inventory" class="menu-item">
                    <i class="fas fa-boxes text-info"></i>
                    <div>
                        <div class="menu-item-text">Inventory</div>
                        <div class="menu-item-desc">Track materials and supplies</div>
                    </div>
                </a>
                
                <a href="/admin/checklists" class="menu-item">
                    <i class="fas fa-tasks text-secondary"></i>
                    <div>
                        <div class="menu-item-text">Job Checklists</div>
                        <div class="menu-item-desc">Track job completion</div>
                    </div>
                </a>
                

            </div>

            <!-- Operations Section -->
            <div class="menu-section">
                <div class="menu-section-title">Operations</div>
                
                <a href="/admin/staff" class="menu-item">
                    <i class="fas fa-hard-hat text-warning"></i>
                    <div>
                        <div class="menu-item-text">Staff Management</div>
                        <div class="menu-item-desc">Manage crew and assignments</div>
                    </div>
                </a>
                
                <a href="/admin/inventory" class="menu-item">
                    <i class="fas fa-boxes text-info"></i>
                    <div>
                        <div class="menu-item-text">Inventory</div>
                        <div class="menu-item-desc">Track materials and supplies</div>
                    </div>
                </a>
                
                <a href="/admin/checklists" class="menu-item">
                    <i class="fas fa-tasks text-secondary"></i>
                    <div>
                        <div class="menu-item-text">Job Checklists</div>
                        <div class="menu-item-desc">Track job completion</div>
                    </div>
                </a>
                
                <a href="/admin/scheduler/unified" class="menu-item">
                    <i class="fas fa-calendar-week text-primary"></i>
                    <div>
                        <div class="menu-item-text">Advanced Scheduler</div>
                        <div class="menu-item-desc">Comprehensive scheduling tools</div>
                    </div>
                </a>
            </div>

            <!-- Analytics Section -->
            <div class="menu-section">
                <div class="menu-section-title">Analytics & Intelligence</div>
                
                <a href="/admin/analytics-dashboard" class="menu-item">
                    <i class="fas fa-chart-bar text-info"></i>
                    <div>
                        <div class="menu-item-text">Analytics Dashboard</div>
                        <div class="menu-item-desc">Business performance metrics</div>
                    </div>
                </a>
                
                <a href="/admin/business-intelligence" class="menu-item">
                    <i class="fas fa-brain text-success"></i>
                    <div>
                        <div class="menu-item-text">Business Intelligence</div>
                        <div class="menu-item-desc">Strategic insights and recommendations</div>
                    </div>
                </a>
                
                <a href="/admin/ml-insights" class="menu-item">
                    <i class="fas fa-magic text-warning"></i>
                    <div>
                        <div class="menu-item-text">ML Insights</div>
                        <div class="menu-item-desc">AI-powered analytics</div>
                    </div>
                </a>
                
                <a href="/admin/integrated-analytics" class="menu-item">
                    <i class="fas fa-chart-line text-dark"></i>
                    <div>
                        <div class="menu-item-text">Analytics Command</div>
                        <div class="menu-item-desc">Integrated analytics platform</div>
                    </div>
                </a>
            </div>

            <!-- Advanced Tools Section -->
            <div class="menu-section">
                <div class="menu-section-title">Advanced Tools</div>
                

                
                <a href="/admin/scheduler/advanced" class="menu-item">
                    <i class="fas fa-calendar-alt text-dark"></i>
                    <div>
                        <div class="menu-item-text">Advanced Scheduler</div>
                        <div class="menu-item-desc">Professional scheduling interface</div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Content -->
    <div class="row g-4">
        <!-- Full Width - Weekly Schedule -->
        <div class="col-12">
            <div class="card border-0 shadow-lg h-100" style="border-left: 4px solid #28a745 !important;">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center py-3">
                    <h4 class="mb-0 fw-bold">
                        <i class="fas fa-calendar-week me-2"></i>
                        <span id="scheduleTitle">SPANKKS Weekly Schedule</span>
                    </h4>
                    <div class="d-flex align-items-center">
                        <!-- Week Navigation -->
                        <div class="d-flex align-items-center me-3">
                            <button type="button" class="btn btn-outline-light btn-sm me-2" id="prevWeek">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button type="button" class="btn btn-outline-light btn-sm me-2" id="nextWeek">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                            <button type="button" class="btn btn-outline-light btn-sm me-3" id="todayBtn" onclick="goToToday()">
                                Today
                            </button>
                        </div>
                        
                        <!-- View Switcher -->
                        <div class="btn-group btn-group-sm me-3" role="group">
                            <button type="button" class="btn btn-outline-light active" id="weekView" onclick="switchView('week')">
                                <i class="fas fa-calendar-week me-1"></i>Week
                            </button>
                            <button type="button" class="btn btn-outline-light" id="monthView" onclick="switchView('month')">
                                <i class="fas fa-calendar-alt me-1"></i>4 Weeks
                            </button>
                        </div>
                        <!-- Date Range -->
                        <small id="dateRange">
                            
                            June 16 - June 22, 2025
                            
                        </small>
                    </div>
                </div>
                <div class="card-body p-0">
                    <!-- Calendar Status Badges -->
                    <div class="p-3 border-bottom">
                        <div class="row g-2">
                            <div class="col-6 col-md-3">
                                <span class="badge bg-success d-block py-2">
                                    <i class="fas fa-dollar-sign me-1"></i>
                                    Invoice Management
                                </span>
                            </div>
                            <div class="col-6 col-md-3">
                                <span class="badge bg-dark d-block py-2">
                                    <i class="fas fa-users me-1"></i>
                                    Staff Management
                                </span>
                            </div>
                            <div class="col-6 col-md-3">
                                <span class="badge bg-info d-block py-2">
                                    <i class="fas fa-tasks me-1"></i>
                                    Job Tracking
                                </span>
                            </div>
                            <div class="col-6 col-md-3">
                                <span class="badge bg-warning d-block py-2">
                                    <i class="fas fa-chart-bar me-1"></i>
                                    Financial Reports
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Weekly View (Default) -->
                    <div class="p-3" id="weeklyView">
                        
                        <!-- Time Slot Schedule -->
                        <div class="time-slot-schedule">
                            <!-- Header Row with Days -->
                            <div class="schedule-header">
                                <div class="time-column-header">Time</div>
                                
                                <div class="day-column-header text-center bg-light">
                                    <div class="fw-bold">Mon</div>
                                    <div class="h6 mb-0">06/16</div>
                                </div>
                                
                                <div class="day-column-header text-center bg-light">
                                    <div class="fw-bold">Tue</div>
                                    <div class="h6 mb-0">06/17</div>
                                </div>
                                
                                <div class="day-column-header text-center bg-light">
                                    <div class="fw-bold">Wed</div>
                                    <div class="h6 mb-0">06/18</div>
                                </div>
                                
                                <div class="day-column-header text-center bg-light">
                                    <div class="fw-bold">Thu</div>
                                    <div class="h6 mb-0">06/19</div>
                                </div>
                                
                                <div class="day-column-header text-center bg-light">
                                    <div class="fw-bold">Fri</div>
                                    <div class="h6 mb-0">06/20</div>
                                </div>
                                
                                <div class="day-column-header text-center bg-light">
                                    <div class="fw-bold">Sat</div>
                                    <div class="h6 mb-0">06/21</div>
                                </div>
                                
                                <div class="day-column-header text-center bg-primary text-white">
                                    <div class="fw-bold">Sun</div>
                                    <div class="h6 mb-0">06/22</div>
                                </div>
                                
                            </div>
                            
                            <!-- Time Slots -->
                            
                            
                            
                            <div class="schedule-row">
                                <div class="time-column">
                                    <span class="time-label">7:00 AM</span>
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-16" data-time="07:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-16" data-time="07:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-17" data-time="07:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-17" data-time="07:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-18" data-time="07:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-18" data-time="07:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-19" data-time="07:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-19" data-time="07:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-20" data-time="07:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-20" data-time="07:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-21" data-time="07:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-21" data-time="07:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-22" data-time="07:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-22" data-time="07:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                            </div>
                            
                            <div class="schedule-row">
                                <div class="time-column">
                                    <span class="time-label">8:00 AM</span>
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-16" data-time="08:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-16" data-time="08:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-17" data-time="08:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-17" data-time="08:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-18" data-time="08:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-18" data-time="08:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-19" data-time="08:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-19" data-time="08:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-20" data-time="08:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-20" data-time="08:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-21" data-time="08:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-21" data-time="08:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-22" data-time="08:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-22" data-time="08:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                            </div>
                            
                            <div class="schedule-row">
                                <div class="time-column">
                                    <span class="time-label">9:00 AM</span>
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-16" data-time="09:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-16" data-time="09:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-17" data-time="09:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-17" data-time="09:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-18" data-time="09:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-18" data-time="09:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-19" data-time="09:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-19" data-time="09:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-20" data-time="09:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-20" data-time="09:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-21" data-time="09:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-21" data-time="09:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-22" data-time="09:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-22" data-time="09:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                            </div>
                            
                            <div class="schedule-row">
                                <div class="time-column">
                                    <span class="time-label">10:00 AM</span>
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-16" data-time="10:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-16" data-time="10:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-17" data-time="10:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-17" data-time="10:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-18" data-time="10:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-18" data-time="10:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-19" data-time="10:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-19" data-time="10:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-20" data-time="10:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-20" data-time="10:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-21" data-time="10:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-21" data-time="10:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-22" data-time="10:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-22" data-time="10:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                            </div>
                            
                            <div class="schedule-row">
                                <div class="time-column">
                                    <span class="time-label">11:00 AM</span>
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-16" data-time="11:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-16" data-time="11:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-17" data-time="11:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-17" data-time="11:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-18" data-time="11:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-18" data-time="11:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-19" data-time="11:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-19" data-time="11:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-20" data-time="11:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-20" data-time="11:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-21" data-time="11:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-21" data-time="11:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-22" data-time="11:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-22" data-time="11:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                            </div>
                            
                            <div class="schedule-row">
                                <div class="time-column">
                                    <span class="time-label">12:00 PM</span>
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-16" data-time="12:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-16" data-time="12:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-17" data-time="12:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-17" data-time="12:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-18" data-time="12:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-18" data-time="12:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-19" data-time="12:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-19" data-time="12:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-20" data-time="12:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-20" data-time="12:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-21" data-time="12:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-21" data-time="12:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-22" data-time="12:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-22" data-time="12:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                            </div>
                            
                            <div class="schedule-row">
                                <div class="time-column">
                                    <span class="time-label">1:00 PM</span>
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-16" data-time="13:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-16" data-time="13:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-17" data-time="13:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-17" data-time="13:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-18" data-time="13:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-18" data-time="13:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-19" data-time="13:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-19" data-time="13:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-20" data-time="13:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-20" data-time="13:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-21" data-time="13:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-21" data-time="13:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-22" data-time="13:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-22" data-time="13:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                            </div>
                            
                            <div class="schedule-row">
                                <div class="time-column">
                                    <span class="time-label">2:00 PM</span>
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-16" data-time="14:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-16" data-time="14:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-17" data-time="14:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-17" data-time="14:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-18" data-time="14:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-18" data-time="14:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-19" data-time="14:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-19" data-time="14:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-20" data-time="14:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-20" data-time="14:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-21" data-time="14:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-21" data-time="14:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-22" data-time="14:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-22" data-time="14:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                            </div>
                            
                            <div class="schedule-row">
                                <div class="time-column">
                                    <span class="time-label">3:00 PM</span>
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-16" data-time="15:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-16" data-time="15:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-17" data-time="15:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-17" data-time="15:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-18" data-time="15:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-18" data-time="15:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-19" data-time="15:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-19" data-time="15:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-20" data-time="15:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-20" data-time="15:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-21" data-time="15:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-21" data-time="15:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-22" data-time="15:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-22" data-time="15:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                            </div>
                            
                            <div class="schedule-row">
                                <div class="time-column">
                                    <span class="time-label">4:00 PM</span>
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-16" data-time="16:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-16" data-time="16:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-17" data-time="16:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-17" data-time="16:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-18" data-time="16:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-18" data-time="16:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-19" data-time="16:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-19" data-time="16:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-20" data-time="16:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-20" data-time="16:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-21" data-time="16:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-21" data-time="16:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-22" data-time="16:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-22" data-time="16:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                            </div>
                            
                            <div class="schedule-row">
                                <div class="time-column">
                                    <span class="time-label">5:00 PM</span>
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-16" data-time="17:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-16" data-time="17:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-17" data-time="17:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-17" data-time="17:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-18" data-time="17:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-18" data-time="17:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-19" data-time="17:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-19" data-time="17:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-20" data-time="17:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-20" data-time="17:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-21" data-time="17:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-21" data-time="17:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                                <div class="appointment-slot" data-date="2025-06-22" data-time="17:00">
                                    
                                    
                                    
                                    
                                        <div class="empty-slot" data-date="2025-06-22" data-time="17:00" style="cursor: pointer;">
                                            <i class="fas fa-plus text-muted"></i>
                                        </div>
                                    
                                </div>
                                
                            </div>
                            
                        </div>
                        
                    </div>

                    <!-- Extended View (4 Weeks) - Hidden by default -->
                    <div class="p-3 d-none" id="extendedView">
                        
                            
                            <div class="mb-4 border-bottom pb-3">
                                <!-- Week Header -->
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="fw-bold mb-0 text-primary">
                                        <i class="fas fa-calendar-week me-1"></i>
                                        Week 1 
                                        
                                            <span class="badge bg-primary ms-2">Current</span>
                                        
                                    </h6>
                                    <small class="text-muted">
                                        Jun 16 - Jun 22
                                    </small>
                                </div>
                                
                                <!-- Week Days -->
                                <div class="row g-2">
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Mon</div>
                                                <div class="h6 mb-0">16</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-16"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Tue</div>
                                                <div class="h6 mb-0">17</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-17"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Wed</div>
                                                <div class="h6 mb-0">18</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-18"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Thu</div>
                                                <div class="h6 mb-0">19</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-19"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Fri</div>
                                                <div class="h6 mb-0">20</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-20"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Sat</div>
                                                <div class="h6 mb-0">21</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-21"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-primary text-white">
                                                <div class="fw-bold small">Sun</div>
                                                <div class="h6 mb-0">22</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-22"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="mb-4 border-bottom pb-3">
                                <!-- Week Header -->
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="fw-bold mb-0 text-muted">
                                        <i class="fas fa-calendar-week me-1"></i>
                                        Week 2 
                                        
                                    </h6>
                                    <small class="text-muted">
                                        Jun 23 - Jun 29
                                    </small>
                                </div>
                                
                                <!-- Week Days -->
                                <div class="row g-2">
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Mon</div>
                                                <div class="h6 mb-0">23</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-23"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Tue</div>
                                                <div class="h6 mb-0">24</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-24"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Wed</div>
                                                <div class="h6 mb-0">25</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-25"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Thu</div>
                                                <div class="h6 mb-0">26</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-26"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Fri</div>
                                                <div class="h6 mb-0">27</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-27"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Sat</div>
                                                <div class="h6 mb-0">28</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-28"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Sun</div>
                                                <div class="h6 mb-0">29</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-29"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="mb-4 border-bottom pb-3">
                                <!-- Week Header -->
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="fw-bold mb-0 text-muted">
                                        <i class="fas fa-calendar-week me-1"></i>
                                        Week 3 
                                        
                                    </h6>
                                    <small class="text-muted">
                                        Jun 30 - Jul 06
                                    </small>
                                </div>
                                
                                <!-- Week Days -->
                                <div class="row g-2">
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Mon</div>
                                                <div class="h6 mb-0">30</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-06-30"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Tue</div>
                                                <div class="h6 mb-0">01</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-01"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Wed</div>
                                                <div class="h6 mb-0">02</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-02"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Thu</div>
                                                <div class="h6 mb-0">03</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-03"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Fri</div>
                                                <div class="h6 mb-0">04</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-04"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Sat</div>
                                                <div class="h6 mb-0">05</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-05"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Sun</div>
                                                <div class="h6 mb-0">06</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-06"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                            <div class="mb-4 ">
                                <!-- Week Header -->
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h6 class="fw-bold mb-0 text-muted">
                                        <i class="fas fa-calendar-week me-1"></i>
                                        Week 4 
                                        
                                    </h6>
                                    <small class="text-muted">
                                        Jul 07 - Jul 13
                                    </small>
                                </div>
                                
                                <!-- Week Days -->
                                <div class="row g-2">
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Mon</div>
                                                <div class="h6 mb-0">07</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-07"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Tue</div>
                                                <div class="h6 mb-0">08</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-08"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Wed</div>
                                                <div class="h6 mb-0">09</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-09"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Thu</div>
                                                <div class="h6 mb-0">10</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-10"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Fri</div>
                                                <div class="h6 mb-0">11</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-11"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Sat</div>
                                                <div class="h6 mb-0">12</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-12"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col">
                                        <div class="calendar-day-card h-100" style="min-height: 100px;">
                                            <div class="day-header text-center p-2 bg-light">
                                                <div class="fw-bold small">Sun</div>
                                                <div class="h6 mb-0">13</div>
                                            </div>
                                            <div class="day-content p-1 drop-zone" 
                                                 style="min-height: 60px;"
                                                 data-date="2025-07-13"
                                                 ondrop="dropAppointment(event)" 
                                                 ondragover="allowDrop(event)"
                                                 ondragenter="dragEnter(event)"
                                                 ondragleave="dragLeave(event)">
                                                
                                                
                                                
                                                
                                                    <div class="text-center text-muted mt-2" style="font-size: 0.65rem;">
                                                        <i class="fas fa-plus-circle"></i>
                                                        <div>Open</div>
                                                    </div>
                                                
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </div>
                            
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- New Appointment Modal -->
<div class="modal fade" id="newAppointmentModal" tabindex="-1" aria-labelledby="newAppointmentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="newAppointmentModalLabel">
                    <i class="fas fa-calendar-plus me-2"></i>New Appointment
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="newAppointmentForm">
                    <div class="mb-3">
                        <label for="appointmentDate" class="form-label">Date</label>
                        <input type="date" class="form-control" id="appointmentDate" required readonly>
                    </div>
                    <div class="mb-3">
                        <label for="appointmentTime" class="form-label">Time</label>
                        <select class="form-select" id="appointmentTime" required>
                            <option value="7:00">7:00 AM</option>
                            <option value="8:00">8:00 AM</option>
                            <option value="9:00">9:00 AM</option>
                            <option value="10:00">10:00 AM</option>
                            <option value="11:00">11:00 AM</option>
                            <option value="12:00">12:00 PM</option>
                            <option value="13:00">1:00 PM</option>
                            <option value="14:00">2:00 PM</option>
                            <option value="15:00">3:00 PM</option>
                            <option value="16:00">4:00 PM</option>
                            <option value="17:00">5:00 PM</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="clientName" class="form-label">Client Name</label>
                        <input type="text" class="form-control" id="clientName" required>
                    </div>
                    <div class="mb-3">
                        <label for="clientPhone" class="form-label">Phone Number</label>
                        <input type="tel" class="form-control" id="clientPhone" required>
                    </div>
                    <div class="mb-3">
                        <label for="serviceType" class="form-label">Service Type</label>
                        <select class="form-select" id="serviceType" required>
                            <option value="">Select Service</option>
                            <option value="Drywall Services">Drywall Services</option>
                            <option value="Flooring Installation">Flooring Installation</option>
                            <option value="Fence Building">Fence Building</option>
                            <option value="General Handyman">General Handyman</option>
                            <option value="Plumbing Repair">Plumbing Repair</option>
                            <option value="Electrical Work">Electrical Work</option>
                            <option value="Painting">Painting</option>
                            <option value="Home Renovation">Home Renovation</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="serviceDescription" class="form-label">Service Description</label>
                        <textarea class="form-control" id="serviceDescription" rows="3" placeholder="Brief description of the work needed"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="estimatedDuration" class="form-label">Estimated Duration (hours)</label>
                        <select class="form-select" id="estimatedDuration">
                            <option value="1">1 hour</option>
                            <option value="2">2 hours</option>
                            <option value="3">3 hours</option>
                            <option value="4">4 hours</option>
                            <option value="6">6 hours</option>
                            <option value="8">8 hours (Full day)</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createAppointment()">
                    <i class="fas fa-save me-1"></i>Create Appointment
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Pending Items Modal -->
<div class="modal fade" id="pendingDetailsModal" tabindex="-1" aria-labelledby="pendingDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="pendingDetailsModalLabel">
                    <i class="fas fa-clock me-2"></i>Pending Items
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-12">
                        <h6 class="mb-3"><i class="fas fa-clipboard-check me-2"></i>Pending Service Requests</h6>
                        
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-check-circle fa-3x mb-3"></i>
                            <h6>No Pending Requests</h6>
                            <p>All service requests have been processed.</p>
                        </div>
                        
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="window.location.href='/admin/project-tracking'">
                    <i class="fas fa-tasks me-1"></i>Manage All Requests
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Appointment Details Modal -->
<div class="modal fade" id="appointmentDetailsModal" tabindex="-1" aria-labelledby="appointmentDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="appointmentDetailsModalLabel">
                    <i class="fas fa-calendar-check me-2"></i>Appointment Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label"><strong>Client Name:</strong></label>
                            <p id="detailClientName" class="mb-1">-</p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label"><strong>Service:</strong></label>
                            <p id="detailService" class="mb-1">-</p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label"><strong>Date & Time:</strong></label>
                            <p id="detailDateTime" class="mb-1">-</p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label class="form-label"><strong>Estimated Amount:</strong></label>
                            <p id="detailAmount" class="mb-1">-</p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label"><strong>Status:</strong></label>
                            <p id="detailStatus" class="mb-1">-</p>
                        </div>
                        <div class="mb-3">
                            <label class="form-label"><strong>Appointment ID:</strong></label>
                            <p id="detailId" class="mb-1">-</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="editAppointment()">
                    <i class="fas fa-edit me-1"></i>Edit Appointment
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Payment Tracking Modal -->
<div class="modal fade" id="paymentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Mark Invoice as Paid</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="paymentForm">
                    <div class="mb-3">
                        <label class="form-label">Invoice ID:</label>
                        <input type="text" class="form-control" id="paymentInvoiceId" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Payment Amount:</label>
                        <input type="number" class="form-control" id="paymentAmount" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Payment Method:</label>
                        <select class="form-select" id="paymentMethod" required>
                            <option value="">Select Method</option>
                            <option value="cash">Cash</option>
                            <option value="check">Check</option>
                            <option value="venmo">Venmo</option>
                            <option value="zelle">Zelle</option>
                            <option value="bank_transfer">Bank Transfer</option>
                            <option value="credit_card">Credit Card</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Notes (Optional):</label>
                        <textarea class="form-control" id="paymentNotes" rows="2"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" onclick="submitPayment()">Mark as Paid</button>
            </div>
        </div>
    </div>
</div>

<!-- Staff Management Modal -->
<div class="modal fade" id="staffModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Enhanced Staff Management</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="staffSummary">
                    <p class="text-center"><i class="fas fa-spinner fa-spin"></i> Loading staff data...</p>
                </div>
                
                <hr>
                
                <h6>Add New Staff Member</h6>
                <form id="staffForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Name:</label>
                            <input type="text" class="form-control" id="staffName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Role:</label>
                            <select class="form-select" id="staffRole" required>
                                <option value="">Select Role</option>
                                <option value="admin">Admin</option>
                                <option value="supervisor">Supervisor</option>
                                <option value="crew_member">Crew Member</option>
                                <option value="specialist">Specialist</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Phone:</label>
                            <input type="tel" class="form-control" id="staffPhone">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Hourly Rate:</label>
                            <input type="number" class="form-control" id="staffRate" step="0.01" value="25.00">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="addStaffMember()">Add Staff</button>
            </div>
        </div>
    </div>
</div>

<script>
// Side Menu Functionality
function toggleSideMenu() {
    const sideMenu = document.getElementById('sideMenu');
    const overlay = document.getElementById('sideMenuOverlay');
    const toggleBtn = document.getElementById('quickActionsToggle');
    
    if (sideMenu.classList.contains('active')) {
        closeSideMenu();
    } else {
        openSideMenu();
    }
}

function openSideMenu() {
    const sideMenu = document.getElementById('sideMenu');
    const overlay = document.getElementById('sideMenuOverlay');
    const toggleBtn = document.getElementById('quickActionsToggle');
    
    sideMenu.classList.add('active');
    overlay.style.display = 'block';
    toggleBtn.classList.add('active');
    
    // Change icon to close
    const icon = toggleBtn.querySelector('i');
    icon.className = 'fas fa-times';
    
    // Prevent body scroll when menu is open
    document.body.style.overflow = 'hidden';
}

function closeSideMenu() {
    const sideMenu = document.getElementById('sideMenu');
    const overlay = document.getElementById('sideMenuOverlay');
    const toggleBtn = document.getElementById('quickActionsToggle');
    
    sideMenu.classList.remove('active');
    overlay.style.display = 'none';
    toggleBtn.classList.remove('active');
    
    // Change icon back to bolt
    const icon = toggleBtn.querySelector('i');
    icon.className = 'fas fa-bolt';
    
    // Restore body scroll
    document.body.style.overflow = '';
}

// Close menu when pressing Escape key
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeSideMenu();
    }
});

// Close menu when clicking on menu items (for better UX)
document.addEventListener('DOMContentLoaded', function() {
    const menuItems = document.querySelectorAll('.menu-item');
    menuItems.forEach(item => {
        item.addEventListener('click', function() {
            // Small delay to allow the navigation to start
            setTimeout(closeSideMenu, 100);
        });
    });
});

// Add CSS for time slot schedule
const timeSlotStyles = `
<style>
.time-slot-schedule {
    display: grid;
    grid-template-rows: auto repeat(11, 1fr);
    border: 1px solid #dee2e6;
    border-radius: 8px;
    overflow: hidden;
    background: white;
}

.schedule-header {
    display: grid;
    grid-template-columns: 100px repeat(7, 1fr);
    background: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
}

.time-column-header {
    padding: 12px 8px;
    font-weight: bold;
    background: #6c757d;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
}

.day-column-header {
    padding: 12px 8px;
    border-left: 1px solid #dee2e6;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 60px;
}

.schedule-row {
    display: grid;
    grid-template-columns: 100px repeat(7, 1fr);
    border-bottom: 1px solid #dee2e6;
    min-height: 50px;
}

.time-column {
    padding: 8px;
    background: #f8f9fa;
    border-right: 1px solid #dee2e6;
    display: flex;
    align-items: center;
    justify-content: center;
}

.time-label {
    font-size: 0.8rem;
    font-weight: 500;
    color: #495057;
}

.appointment-slot {
    padding: 4px;
    border-left: 1px solid #dee2e6;
    position: relative;
    cursor: pointer;
    transition: background-color 0.2s;
    min-height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.appointment-slot:hover {
    background-color: #f8f9fa;
}

.appointment-block {
    width: 100%;
    max-width: 100%;
    margin: 0;
    font-size: 0.75rem;
    line-height: 1.2;
    padding: 4px 6px !important;
}

.empty-slot {
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.3;
    transition: opacity 0.2s;
}

.appointment-slot:hover .empty-slot {
    opacity: 0.8;
}

.empty-slot i {
    font-size: 1.2rem;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .schedule-header,
    .schedule-row {
        grid-template-columns: 80px repeat(7, 1fr);
    }
    
    .time-column-header,
    .time-column {
        padding: 8px 4px;
    }
    
    .time-label {
        font-size: 0.7rem;
    }
    
    .day-column-header {
        padding: 8px 4px;
        font-size: 0.8rem;
    }
    
    .appointment-block {
        font-size: 0.65rem;
        padding: 2px 4px !important;
    }
}
</style>
`;

document.head.insertAdjacentHTML('beforeend', timeSlotStyles);

// Schedule view switching functionality
function switchView(viewType) {
    const weekBtn = document.getElementById('weekView');
    const monthBtn = document.getElementById('monthView');
    const weeklyView = document.getElementById('weeklyView');
    const extendedView = document.getElementById('extendedView');
    const scheduleTitle = document.getElementById('scheduleTitle');
    const dateRange = document.getElementById('dateRange');
    
    if (viewType === 'week') {
        // Switch to weekly view
        weekBtn.classList.add('active');
        monthBtn.classList.remove('active');
        weeklyView.classList.remove('d-none');
        extendedView.classList.add('d-none');
        scheduleTitle.textContent = 'Weekly Schedule';
        
        // Update date range for weekly view
        
        dateRange.innerHTML = 'June 16 - June 22, 2025';
        
    } else if (viewType === 'month') {
        // Switch to extended view
        weekBtn.classList.remove('active');
        monthBtn.classList.add('active');
        weeklyView.classList.add('d-none');
        extendedView.classList.remove('d-none');
        scheduleTitle.textContent = 'Extended Schedule (4 Weeks)';
        
        // Update date range for extended view
        
        dateRange.innerHTML = 'June 16 - July 13, 2025';
        
    }
}

// Week navigation functionality
let currentWeekOffset = 0; // 0 = current week, -1 = last week, 1 = next week

function changeWeek(direction) {
    currentWeekOffset += direction;
    
    // Update the URL with week parameter and reload
    const url = new URL(window.location);
    url.searchParams.set('week_offset', currentWeekOffset);
    window.location.href = url.toString();
}

function goToToday() {
    currentWeekOffset = 0;
    
    // Remove week_offset parameter and reload
    const url = new URL(window.location);
    url.searchParams.delete('week_offset');
    window.location.href = url.toString();
}

// Initialize current week offset from URL parameter
document.addEventListener('DOMContentLoaded', function() {
    const urlParams = new URLSearchParams(window.location.search);
    const weekOffset = urlParams.get('week_offset');
    if (weekOffset) {
        currentWeekOffset = parseInt(weekOffset);
    }
    
    // Update button states based on current week
    updateNavigationButtons();
    
    // Test if appointment modal function is accessible
    console.log('Testing appointment modal function:', typeof openNewAppointmentModal);
    window.openNewAppointmentModal = openNewAppointmentModal;
    
    // Add click listeners for navigation buttons
    const prevWeekBtn = document.getElementById('prevWeek');
    const nextWeekBtn = document.getElementById('nextWeek');
    
    if (prevWeekBtn) {
        prevWeekBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Previous week clicked');
            changeWeek(-1);
        });
    }
    
    if (nextWeekBtn) {
        nextWeekBtn.addEventListener('click', function(e) {
            e.preventDefault();
            console.log('Next week clicked');
            changeWeek(1);
        });
    }
    
    // Add click listeners for empty appointment slots
    document.querySelectorAll('.empty-slot').forEach(slot => {
        slot.addEventListener('click', function() {
            const date = this.getAttribute('data-date');
            const time = this.getAttribute('data-time');
            console.log('Empty slot clicked:', date, time);
            openNewAppointmentModal(date, time);
        });
    });
});

// Week navigation function
function changeWeek(direction) {
    console.log('changeWeek called with direction:', direction);
    currentWeekOffset += direction;
    
    // Reload page with new week offset
    const url = new URL(window.location);
    url.searchParams.set('week_offset', currentWeekOffset);
    console.log('Navigating to:', url.toString());
    window.location.href = url.toString();
}

// Show appointment details function
function showAppointmentDetails(id, clientName, service, amount, status, time, date) {
    console.log('Showing appointment details:', {id, clientName, service, amount, status, time, date});
    
    // Populate modal fields
    document.getElementById('detailId').textContent = id || 'N/A';
    document.getElementById('detailClientName').textContent = clientName || 'Unknown Client';
    document.getElementById('detailService').textContent = service || 'No service specified';
    document.getElementById('detailAmount').textContent = amount && amount !== 'TBD' ? `$${amount}` : 'To be determined';
    document.getElementById('detailStatus').textContent = status || 'Scheduled';
    
    // Format date and time
    const formattedDate = new Date(date).toLocaleDateString('en-US', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    const formattedTime = time.includes(':') ? 
        new Date(`2000-01-01T${time}`).toLocaleTimeString('en-US', {
            hour: 'numeric',
            minute: '2-digit',
            hour12: true
        }) : time;
    
    document.getElementById('detailDateTime').textContent = `${formattedDate} at ${formattedTime}`;
    
    // Show the modal
    const modal = new bootstrap.Modal(document.getElementById('appointmentDetailsModal'));
    modal.show();
}

// Edit appointment function placeholder
function editAppointment() {
    console.log('Edit appointment functionality not implemented yet');
    // Close details modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('appointmentDetailsModal'));
    if (modal) {
        modal.hide();
    }
    // Could open edit form or navigate to edit page
}

function updateNavigationButtons() {
    const todayBtn = document.getElementById('todayBtn');
    
    // Highlight "Today" button if we're viewing current week
    if (currentWeekOffset === 0) {
        todayBtn.classList.add('btn-light');
        todayBtn.classList.remove('btn-outline-light');
    } else {
        todayBtn.classList.remove('btn-light');
        todayBtn.classList.add('btn-outline-light');
    }
}

// Appointment modal functions
function openNewAppointmentModal(date, time) {
    console.log('openNewAppointmentModal called with:', date, time);
    
    // Set the date and time in the modal
    document.getElementById('appointmentDate').value = date;
    document.getElementById('appointmentTime').value = time;
    
    // Convert time to display format for the time selector
    const timeOptions = {
        '7:00': '7:00', '8:00': '8:00', '9:00': '9:00', '10:00': '10:00',
        '11:00': '11:00', '12:00': '12:00', '13:00': '13:00', '14:00': '14:00',
        '15:00': '15:00', '16:00': '16:00', '17:00': '17:00'
    };
    
    if (timeOptions[time]) {
        document.getElementById('appointmentTime').value = time;
    }
    
    // Clear any previous form data
    document.getElementById('newAppointmentForm').reset();
    document.getElementById('appointmentDate').value = date;
    document.getElementById('appointmentTime').value = time;
    
    // Show the modal
    const modal = new bootstrap.Modal(document.getElementById('newAppointmentModal'));
    modal.show();
}

function createAppointment() {
    const form = document.getElementById('newAppointmentForm');
    
    // Validate form
    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }
    
    // Collect form data
    const appointmentData = {
        date: document.getElementById('appointmentDate').value,
        time: document.getElementById('appointmentTime').value,
        client_name: document.getElementById('clientName').value,
        client_phone: document.getElementById('clientPhone').value,
        service_type: document.getElementById('serviceType').value,
        service_description: document.getElementById('serviceDescription').value,
        estimated_duration: document.getElementById('estimatedDuration').value
    };
    
    // Create appointment via API
    fetch('/api/appointments/create', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(appointmentData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('newAppointmentModal'));
            modal.hide();
            
            // Show success message
            alert('Appointment created successfully!');
            
            // Reload the page to show the new appointment
            window.location.reload();
        } else {
            alert('Error creating appointment: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error creating appointment. Please try again.');
    });
}

// Show pending details modal
function showPendingDetails() {
    console.log('Showing pending details modal');
    const modal = new bootstrap.Modal(document.getElementById('pendingDetailsModal'));
    modal.show();
}

// Update request status
function updateRequestStatus(requestId, status) {
    console.log('Updating request status:', requestId, status);
    
    fetch(`/admin/update-booking/${requestId}`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `status=${status}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Show success message
            alert(`Request ${status} successfully!`);
            
            // Reload the page to reflect changes
            window.location.reload();
        } else {
            alert('Error updating request: ' + (data.error || 'Unknown error'));
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error updating request. Please try again.');
    });
}

// View request details
function viewRequestDetails(requestId) {
    console.log('Viewing request details:', requestId);
    
    // Close pending modal
    const pendingModal = bootstrap.Modal.getInstance(document.getElementById('pendingDetailsModal'));
    if (pendingModal) {
        pendingModal.hide();
    }
    
    // Navigate to project tracking for detailed view
    window.location.href = `/admin/project-tracking#request-${requestId}`;
}

// ========== ADVANCED DRAG & DROP FUNCTIONALITY ==========

let draggedAppointment = null;
let draggedElement = null;

// Drag and Drop Event Handlers
function allowDrop(event) {
    event.preventDefault();
    const dropZone = event.currentTarget;
    if (!dropZone.classList.contains('drag-over')) {
        dropZone.classList.add('drag-over');
    }
}

function dragEnter(event) {
    event.preventDefault();
    const dropZone = event.currentTarget;
    dropZone.classList.add('drag-enter');
}

function dragLeave(event) {
    event.preventDefault();
    const dropZone = event.currentTarget;
    dropZone.classList.remove('drag-enter', 'drag-over');
}

function dropAppointment(event) {
    event.preventDefault();
    
    const dropZone = event.currentTarget;
    dropZone.classList.remove('drag-enter', 'drag-over');
    
    if (!draggedAppointment) {
        console.log('No appointment being dragged');
        return;
    }
    
    const newDate = dropZone.dataset.date;
    const appointmentId = draggedAppointment.id;
    const originalDate = draggedAppointment.date;
    
    if (newDate === originalDate) {
        console.log('Dropped on same date, no change needed');
        return;
    }
    
    console.log(`Moving appointment ${appointmentId} from ${originalDate} to ${newDate}`);
    
    // Call API to reschedule appointment
    rescheduleAppointment(appointmentId, newDate, draggedAppointment.time);
    
    // Reset drag state
    draggedAppointment = null;
    if (draggedElement) {
        draggedElement.classList.remove('dragging');
        draggedElement = null;
    }
}

// Initialize drag events for appointment blocks
document.addEventListener('DOMContentLoaded', function() {
    initializeDragAndDrop();
    initializeAdvancedFeatures();
});

function initializeDragAndDrop() {
    document.querySelectorAll('.draggable-appointment').forEach(appointment => {
        appointment.addEventListener('dragstart', function(e) {
            console.log('Drag started for appointment:', this.dataset.appointmentId);
            
            draggedAppointment = {
                id: this.dataset.appointmentId,
                date: this.dataset.appointmentDate,
                time: this.dataset.appointmentTime,
                clientName: this.dataset.clientName,
                service: this.dataset.service
            };
            
            draggedElement = this;
            this.classList.add('dragging');
            
            // Set drag data
            e.dataTransfer.setData('text/plain', JSON.stringify(draggedAppointment));
            e.dataTransfer.effectAllowed = 'move';
        });
        
        appointment.addEventListener('dragend', function() {
            console.log('Drag ended');
            this.classList.remove('dragging');
            
            // Clear all drag states
            document.querySelectorAll('.drop-zone').forEach(zone => {
                zone.classList.remove('drag-enter', 'drag-over');
            });
        });
    });
}

// API call to reschedule appointment
function rescheduleAppointment(appointmentId, newDate, time) {
    showToast('Rescheduling appointment...', 'info');
    
    fetch('/api/unified/reschedule', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            appointment_id: appointmentId,
            new_date: newDate,
            time: time
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showToast('Appointment rescheduled successfully!', 'success');
            // Reload page to show updated schedule
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        } else {
            showToast('Failed to reschedule appointment: ' + (data.error || 'Unknown error'), 'error');
        }
    })
    .catch(error => {
        console.error('Error rescheduling appointment:', error);
        showToast('Error rescheduling appointment. Please try again.', 'error');
    });
}

// ========== ADVANCED CALENDAR FEATURES ==========

function initializeAdvancedFeatures() {
    // Enhanced appointment creation
    initializeQuickBooking();
    
    // Calendar view switching
    initializeViewSwitching();
    
    // Auto-refresh functionality
    initializeAutoRefresh();
    
    // Keyboard shortcuts
    initializeKeyboardShortcuts();
    
    // Enhanced tooltips
    initializeEnhancedTooltips();
}

// Quick booking functionality
function initializeQuickBooking() {
    document.querySelectorAll('.drop-zone').forEach(zone => {
        zone.addEventListener('dblclick', function() {
            const date = this.dataset.date;
            openQuickBookingModal(date);
        });
    });
}

function openQuickBookingModal(date) {
    // Populate date in new appointment modal
    const dateInput = document.querySelector('#newAppointmentModal input[type="date"]');
    if (dateInput) {
        dateInput.value = date;
    }
    
    // Show modal
    const modal = new bootstrap.Modal(document.getElementById('newAppointmentModal'));
    modal.show();
    
    showToast(`Quick booking for ${new Date(date).toLocaleDateString()}`, 'info');
}

// Enhanced view switching
function initializeViewSwitching() {
    // Add view toggle buttons to the interface
    const scheduleTitle = document.querySelector('.schedule-title');
    if (scheduleTitle && !document.querySelector('.view-toggle-buttons')) {
        const viewToggle = document.createElement('div');
        viewToggle.className = 'view-toggle-buttons ms-auto';
        viewToggle.innerHTML = `
            <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-primary btn-sm active" onclick="switchToCalendarView()">
                    <i class="fas fa-calendar-alt me-1"></i>Calendar
                </button>
                <button type="button" class="btn btn-outline-primary btn-sm" onclick="switchToTimelineView()">
                    <i class="fas fa-clock me-1"></i>Timeline
                </button>
                <button type="button" class="btn btn-outline-primary btn-sm" onclick="switchToListView()">
                    <i class="fas fa-list me-1"></i>List
                </button>
            </div>
        `;
        scheduleTitle.appendChild(viewToggle);
    }
}

function switchToCalendarView() {
    document.querySelectorAll('.view-toggle-buttons .btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector('.view-toggle-buttons .btn:first-child').classList.add('active');
    showToast('Switched to Calendar view', 'info');
}

function switchToTimelineView() {
    document.querySelectorAll('.view-toggle-buttons .btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector('.view-toggle-buttons .btn:nth-child(2)').classList.add('active');
    showToast('Timeline view coming soon!', 'info');
}

function switchToListView() {
    document.querySelectorAll('.view-toggle-buttons .btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector('.view-toggle-buttons .btn:last-child').classList.add('active');
    window.location.href = '/admin/scheduler/unified';
}

// Auto-refresh functionality
function initializeAutoRefresh() {
    // Auto-refresh every 2 minutes to show new appointments
    setInterval(() => {
        refreshCalendarData();
    }, 120000);
}

function refreshCalendarData() {
    // Subtle refresh without full page reload
    fetch(window.location.href, {
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.text())
    .then(html => {
        // Extract and update only the calendar portion
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const newCalendar = doc.querySelector('.calendar-day-card');
        
        if (newCalendar) {
            console.log('Calendar data refreshed');
            // Reinitialize drag and drop after refresh
            setTimeout(() => {
                initializeDragAndDrop();
            }, 500);
        }
    })
    .catch(error => {
        console.log('Auto-refresh failed:', error);
    });
}

// Keyboard shortcuts
function initializeKeyboardShortcuts() {
    document.addEventListener('keydown', function(e) {
        // Only trigger shortcuts when not in input fields
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
            return;
        }
        
        // Ctrl+N: New appointment
        if (e.ctrlKey && e.key === 'n') {
            e.preventDefault();
            const modal = new bootstrap.Modal(document.getElementById('newAppointmentModal'));
            modal.show();
        }
        
        // Ctrl+R: Refresh calendar
        if (e.ctrlKey && e.key === 'r') {
            e.preventDefault();
            refreshCalendarData();
            showToast('Calendar refreshed', 'info');
        }
        
        // Arrow keys: Navigate weeks
        if (e.key === 'ArrowLeft' && e.ctrlKey) {
            e.preventDefault();
            changeWeek(-1);
        }
        if (e.key === 'ArrowRight' && e.ctrlKey) {
            e.preventDefault();
            changeWeek(1);
        }
    });
}

// Enhanced tooltips for appointments
function initializeEnhancedTooltips() {
    document.querySelectorAll('.draggable-appointment').forEach(appointment => {
        const clientName = appointment.dataset.clientName;
        const service = appointment.dataset.service;
        const time = appointment.dataset.appointmentTime;
        const date = appointment.dataset.appointmentDate;
        
        appointment.title = `${clientName}\n${service}\n${time} on ${new Date(date).toLocaleDateString()}`;
        
        // Add hover effects
        appointment.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px) scale(1.02)';
            this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
        });
        
        appointment.addEventListener('mouseleave', function() {
            if (!this.classList.contains('dragging')) {
                this.style.transform = '';
                this.style.boxShadow = '';
            }
        });
    });
}

// ========== RECURRING APPOINTMENTS ==========

function createRecurringAppointment() {
    showToast('Recurring appointments feature coming soon!', 'info');
    // This would integrate with the recurring appointment modal from advanced scheduler
}

// ========== CONFLICT DETECTION ==========

function checkSchedulingConflicts(date, time) {
    // Check for scheduling conflicts before creating appointments
    return fetch('/api/unified/check-conflicts', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            date: date,
            time: time
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.conflicts && data.conflicts.length > 0) {
            showToast(`Scheduling conflict detected at ${time}`, 'warning');
            return false;
        }
        return true;
    })
    .catch(error => {
        console.error('Error checking conflicts:', error);
        return true; // Allow scheduling if check fails
    });
}

// ========== ENHANCED APPOINTMENT MODAL ==========

function showEnhancedAppointmentDetails(appointment) {
    // Enhanced version of the appointment details modal
    const modal = document.getElementById('appointmentDetailsModal');
    if (!modal) return;
    
    // Populate enhanced details
    document.getElementById('detailId').textContent = appointment.id;
    document.getElementById('detailClientName').textContent = appointment.clientName;
    document.getElementById('detailService').textContent = appointment.service;
    document.getElementById('detailAmount').textContent = appointment.amount || 'TBD';
    document.getElementById('detailStatus').textContent = appointment.status;
    
    // Add enhanced action buttons if not already present
    const modalFooter = modal.querySelector('.modal-footer');
    if (modalFooter && !modalFooter.querySelector('.enhanced-actions')) {
        const enhancedActions = document.createElement('div');
        enhancedActions.className = 'enhanced-actions';
        enhancedActions.innerHTML = `
            <button type="button" class="btn btn-warning btn-sm" onclick="rescheduleAppointmentModal('${appointment.id}')">
                <i class="fas fa-calendar-alt me-1"></i>Reschedule
            </button>
            <button type="button" class="btn btn-info btn-sm" onclick="duplicateAppointment('${appointment.id}')">
                <i class="fas fa-copy me-1"></i>Duplicate
            </button>
            <button type="button" class="btn btn-success btn-sm" onclick="markCompleted('${appointment.id}')">
                <i class="fas fa-check me-1"></i>Complete
            </button>
        `;
        modalFooter.insertBefore(enhancedActions, modalFooter.querySelector('.btn-secondary'));
    }
    
    new bootstrap.Modal(modal).show();
}

function rescheduleAppointmentModal(appointmentId) {
    showToast('Opening reschedule dialog...', 'info');
    // This would open a dedicated reschedule modal
}

function duplicateAppointment(appointmentId) {
    showToast('Duplicating appointment...', 'info');
    // This would create a copy of the appointment
}

function markCompleted(appointmentId) {
    showToast('Marking appointment as completed...', 'success');
    // This would update the appointment status
}

console.log('✅ Advanced scheduling features initialized');
</script>

    </main>

    <!-- Footer -->
    <footer class="admin-footer bg-dark text-light py-3 mt-5">
        <div class="container text-center">
            <p class="mb-0">&copy; 2025 SPANK Handyman Services Admin Panel</p>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- UX Enhancement Scripts -->
    <script src="/static/js/toast-notifications.js"></script>
    <script src="/static/js/confirmation-modals.js"></script>
    
    <!-- Custom JS -->
    <script src="/static/js/main.js"></script>
    
    
    
    <!-- Include Onboarding Modal -->
    <!-- Getting Started Walkthrough Modal -->
<div class="modal fade" id="onboardingModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-gradient-primary text-white">
                <h5 class="modal-title text-white">
                    <i class="fas fa-rocket me-2"></i>Welcome to SPANKKS Construction
                </h5>
            </div>
            <div class="modal-body p-0">
                <!-- Admin Onboarding Steps -->
                <div id="adminOnboarding" class="onboarding-steps" style="display: none;">
                    <div class="step active" data-step="1">
                        <div class="p-4 text-center">
                            <div class="icon-circle bg-primary-light mb-3 mx-auto" style="width: 80px; height: 80px;">
                                <i class="fas fa-chart-line fa-2x text-primary mt-3"></i>
                            </div>
                            <h4>Dashboard Overview</h4>
                            <p class="text-muted mb-4">Your admin dashboard shows real customer inquiries, weekly schedules, and business metrics. All data here represents actual customer interactions.</p>
                            <div class="bg-light p-3 rounded">
                                <small><strong>Quick Tip:</strong> Use the weekly calendar to manage appointments and the quick action buttons for common tasks.</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step" data-step="2">
                        <div class="p-4 text-center">
                            <div class="icon-circle bg-success-light mb-3 mx-auto" style="width: 80px; height: 80px;">
                                <i class="fas fa-file-invoice-dollar fa-2x text-success mt-3"></i>
                            </div>
                            <h4>Invoice Management</h4>
                            <p class="text-muted mb-4">Track payments, mark invoices as paid, and monitor cash flow. Hawaii GET tax (4.712%) is automatically calculated for all quotes and invoices.</p>
                            <div class="bg-light p-3 rounded">
                                <small><strong>Access:</strong> Click "Mark Payment" from the dashboard sidebar for quick payment tracking.</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step" data-step="3">
                        <div class="p-4 text-center">
                            <div class="icon-circle bg-info-light mb-3 mx-auto" style="width: 80px; height: 80px;">
                                <i class="fas fa-users-cog fa-2x text-info mt-3"></i>
                            </div>
                            <h4>Staff Management</h4>
                            <p class="text-muted mb-4">Manage crew schedules, skills, and assignments. Track performance metrics and availability for optimal job allocation.</p>
                            <div class="bg-light p-3 rounded">
                                <small><strong>Features:</strong> Skills tracking, availability management, performance monitoring, and automated scheduling.</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step" data-step="4">
                        <div class="p-4 text-center">
                            <div class="icon-circle bg-warning-light mb-3 mx-auto" style="width: 80px; height: 80px;">
                                <i class="fas fa-clipboard-check fa-2x text-warning mt-3"></i>
                            </div>
                            <h4>Job Workflow</h4>
                            <p class="text-muted mb-4">Complete customer lifecycle: Inquiry → Quote → Invoice → Job Completion. Each step automatically updates status and notifications.</p>
                            <div class="bg-light p-3 rounded">
                                <small><strong>Workflow:</strong> Dashboard manages the entire process from initial contact to final payment and customer follow-up.</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Staff Onboarding Steps -->
                <div id="staffOnboarding" class="onboarding-steps" style="display: none;">
                    <div class="step active" data-step="1">
                        <div class="p-4 text-center">
                            <div class="icon-circle bg-primary-light mb-3 mx-auto" style="width: 80px; height: 80px;">
                                <i class="fas fa-hard-hat fa-2x text-primary mt-3"></i>
                            </div>
                            <h4>Welcome to the Team</h4>
                            <p class="text-muted mb-4">Access your job assignments, upload photos, generate quotes, and manage tasks through the staff portal system.</p>
                            <div class="bg-light p-3 rounded">
                                <small><strong>Login:</strong> Use your Staff ID and PIN to access job portals: SPK001/30078 + PIN</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step" data-step="2">
                        <div class="p-4 text-center">
                            <div class="icon-circle bg-success-light mb-3 mx-auto" style="width: 80px; height: 80px;">
                                <i class="fas fa-camera fa-2x text-success mt-3"></i>
                            </div>
                            <h4>Job Documentation</h4>
                            <p class="text-muted mb-4">Upload before/after photos, track materials used, and complete job checklists. All photos are automatically organized by job.</p>
                            <div class="bg-light p-3 rounded">
                                <small><strong>Requirements:</strong> Upload before photos at start, after photos at completion, and log all materials used.</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step" data-step="3">
                        <div class="p-4 text-center">
                            <div class="icon-circle bg-info-light mb-3 mx-auto" style="width: 80px; height: 80px;">
                                <i class="fas fa-file-invoice fa-2x text-info mt-3"></i>
                            </div>
                            <h4>Quote & Invoice Tools</h4>
                            <p class="text-muted mb-4">Generate professional quotes and invoices on-site. Hawaii tax is automatically calculated, and PDFs are instantly available.</p>
                            <div class="bg-light p-3 rounded">
                                <small><strong>Access:</strong> Use staff portal toolkit or direct links. Customer details auto-populate when accessed from job portals.</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Client Onboarding Steps -->
                <div id="clientOnboarding" class="onboarding-steps" style="display: none;">
                    <div class="step active" data-step="1">
                        <div class="p-4 text-center">
                            <div class="icon-circle bg-primary-light mb-3 mx-auto" style="width: 80px; height: 80px;">
                                <i class="fas fa-home fa-2x text-primary mt-3"></i>
                            </div>
                            <h4>Welcome to Your Project Portal</h4>
                            <p class="text-muted mb-4">Access your quotes, invoices, project photos, and track job progress through your secure client portal.</p>
                            <div class="bg-light p-3 rounded">
                                <small><strong>Access:</strong> Use your Client ID and Job ID provided by SPANKKS Construction to log in.</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step" data-step="2">
                        <div class="p-4 text-center">
                            <div class="icon-circle bg-success-light mb-3 mx-auto" style="width: 80px; height: 80px;">
                                <i class="fas fa-file-alt fa-2x text-success mt-3"></i>
                            </div>
                            <h4>Quotes & Invoices</h4>
                            <p class="text-muted mb-4">View and download your project quotes and invoices. All documents include detailed breakdowns and Hawaii GET tax calculations.</p>
                            <div class="bg-light p-3 rounded">
                                <small><strong>Features:</strong> PDF downloads, payment status tracking, and detailed service descriptions.</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="step" data-step="3">
                        <div class="p-4 text-center">
                            <div class="icon-circle bg-info-light mb-3 mx-auto" style="width: 80px; height: 80px;">
                                <i class="fas fa-images fa-2x text-info mt-3"></i>
                            </div>
                            <h4>Project Photos</h4>
                            <p class="text-muted mb-4">View before and after photos of your project. Photos are automatically updated as work progresses.</p>
                            <div class="bg-light p-3 rounded">
                                <small><strong>Updates:</strong> Portal refreshes automatically to show new photos and documents as they're added.</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Progress Indicator -->
                <div class="px-4 pb-2">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="progress flex-grow-1 me-3" style="height: 4px;">
                            <div class="progress-bar bg-primary" id="onboardingProgress" style="width: 25%"></div>
                        </div>
                        <small class="text-muted">
                            <span id="currentStep">1</span> of <span id="totalSteps">3</span>
                        </small>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" id="skipOnboarding">Skip Tour</button>
                <button type="button" class="btn btn-secondary" id="prevStep" style="display: none;">Previous</button>
                <button type="button" class="btn btn-primary" id="nextStep">Next</button>
                <button type="button" class="btn btn-success" id="finishOnboarding" style="display: none;">Get Started</button>
            </div>
        </div>
    </div>
</div>

<style>
.onboarding-steps .step {
    display: none;
}

.onboarding-steps .step.active {
    display: block;
}

.icon-circle {
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.bg-primary-light { background-color: rgba(13, 110, 253, 0.1); }
.bg-success-light { background-color: rgba(25, 135, 84, 0.1); }
.bg-info-light { background-color: rgba(13, 202, 240, 0.1); }
.bg-warning-light { background-color: rgba(255, 193, 7, 0.1); }
</style>

<script>
class OnboardingWalkthrough {
    constructor() {
        this.currentStep = 1;
        this.totalSteps = 3;
        this.currentRole = 'admin';
        this.init();
    }
    
    init() {
        this.bindEvents();
        this.checkIfShouldShow();
    }
    
    bindEvents() {
        const nextBtn = document.getElementById('nextStep');
        const prevBtn = document.getElementById('prevStep');
        const skipBtn = document.getElementById('skipOnboarding');
        const finishBtn = document.getElementById('finishOnboarding');
        
        if (nextBtn) nextBtn.addEventListener('click', () => this.nextStep());
        if (prevBtn) prevBtn.addEventListener('click', () => this.prevStep());
        if (skipBtn) skipBtn.addEventListener('click', () => this.skipOnboarding());
        if (finishBtn) finishBtn.addEventListener('click', () => this.finishOnboarding());
    }
    
    checkIfShouldShow() {
        const hasSeenOnboarding = localStorage.getItem('spankks_onboarding_complete');
        const userRole = this.detectUserRole();
        
        if (!hasSeenOnboarding) {
            this.showOnboarding(userRole);
        }
    }
    
    detectUserRole() {
        const path = window.location.pathname;
        
        if (path.includes('/admin') || path.includes('/dashboard')) {
            return 'admin';
        } else if (path.includes('/staff-portal') || path.includes('/portal/staff')) {
            return 'staff';
        } else if (path.includes('/client-portal') || path.includes('/portal/client')) {
            return 'client';
        }
        
        return 'admin';
    }
    
    showOnboarding(role) {
        this.currentRole = role;
        this.currentStep = 1;
        this.totalSteps = role === 'admin' ? 4 : 3;
        
        document.querySelectorAll('.onboarding-steps').forEach(section => {
            section.style.display = 'none';
        });
        
        const sectionId = `${role}Onboarding`;
        const section = document.getElementById(sectionId);
        if (section) {
            section.style.display = 'block';
        }
        
        this.updateStepDisplay();
        
        const modal = new bootstrap.Modal(document.getElementById('onboardingModal'));
        modal.show();
    }
    
    nextStep() {
        if (this.currentStep < this.totalSteps) {
            this.currentStep++;
            this.updateStepDisplay();
        }
    }
    
    prevStep() {
        if (this.currentStep > 1) {
            this.currentStep--;
            this.updateStepDisplay();
        }
    }
    
    updateStepDisplay() {
        const currentSection = document.querySelector(`#${this.currentRole}Onboarding`);
        if (currentSection) {
            const steps = currentSection.querySelectorAll('.step');
            steps.forEach((step, index) => {
                step.classList.toggle('active', index + 1 === this.currentStep);
            });
        }
        
        const progress = (this.currentStep / this.totalSteps) * 100;
        const progressBar = document.getElementById('onboardingProgress');
        if (progressBar) {
            progressBar.style.width = `${progress}%`;
        }
        
        const currentStepSpan = document.getElementById('currentStep');
        const totalStepsSpan = document.getElementById('totalSteps');
        if (currentStepSpan) currentStepSpan.textContent = this.currentStep;
        if (totalStepsSpan) totalStepsSpan.textContent = this.totalSteps;
        
        const prevBtn = document.getElementById('prevStep');
        const nextBtn = document.getElementById('nextStep');
        const finishBtn = document.getElementById('finishOnboarding');
        
        if (prevBtn) prevBtn.style.display = this.currentStep > 1 ? 'inline-block' : 'none';
        if (nextBtn) nextBtn.style.display = this.currentStep < this.totalSteps ? 'inline-block' : 'none';
        if (finishBtn) finishBtn.style.display = this.currentStep === this.totalSteps ? 'inline-block' : 'none';
    }
    
    skipOnboarding() {
        this.markAsComplete();
        this.closeModal();
    }
    
    finishOnboarding() {
        this.markAsComplete();
        this.closeModal();
        this.showWelcomeMessage();
    }
    
    markAsComplete() {
        localStorage.setItem('spankks_onboarding_complete', 'true');
        localStorage.setItem('spankks_onboarding_date', new Date().toISOString());
    }
    
    closeModal() {
        const modal = bootstrap.Modal.getInstance(document.getElementById('onboardingModal'));
        if (modal) {
            modal.hide();
        }
    }
    
    showWelcomeMessage() {
        if (typeof showToast === 'function') {
            showToast('Welcome to SPANKKS Construction! You\'re all set to get started.', 'success');
        }
    }
    
    resetOnboarding() {
        localStorage.removeItem('spankks_onboarding_complete');
        localStorage.removeItem('spankks_onboarding_date');
    }
}

document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('onboardingModal')) {
        window.spankksOnboarding = new OnboardingWalkthrough();
    }
});
</script>
</body>
</html>